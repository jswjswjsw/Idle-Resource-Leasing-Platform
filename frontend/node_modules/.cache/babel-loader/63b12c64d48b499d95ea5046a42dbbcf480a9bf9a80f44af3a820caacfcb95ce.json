{"ast":null,"code":"var _jsxFileName = \"D:\\\\project\\\\trade\\\\frontend\\\\src\\\\pages\\\\WechatCallbackPage.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { useSearchParams, useNavigate } from 'react-router-dom';\nimport { WechatOAuthService } from '../services/wechatOAuthService';\nimport { useAuth } from '../hooks/useAuth';\nimport { toast } from 'react-hot-toast';\n\n/**\n * 微信OAuth回调页面组件\n * 处理微信授权后的回调逻辑\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WechatCallbackPage = () => {\n  _s();\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  const {\n    setUser,\n    setToken\n  } = useAuth();\n  const [isProcessing, setIsProcessing] = useState(true);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const handleCallback = async () => {\n      try {\n        // 从URL参数中获取授权码和状态\n        const code = searchParams.get('code');\n        const state = searchParams.get('state');\n        const errorParam = searchParams.get('error');\n        const errorDescription = searchParams.get('error_description');\n\n        // 检查是否有错误参数\n        if (errorParam) {\n          throw new Error(errorDescription || '微信授权失败');\n        }\n\n        // 检查必需参数\n        if (!code || !state) {\n          throw new Error('缺少必要的授权参数');\n        }\n\n        // 调用后端处理回调\n        const response = await WechatOAuthService.handleCallback(code, state);\n        if (response.success && response.data) {\n          // 保存用户信息和令牌\n          setUser(response.data.user);\n          setToken(response.data.token);\n\n          // 显示成功消息\n          toast.success('微信登录成功！');\n\n          // 跳转到首页或用户指定的页面\n          const redirectTo = localStorage.getItem('wechat_redirect_after_login') || '/';\n          localStorage.removeItem('wechat_redirect_after_login');\n          navigate(redirectTo, {\n            replace: true\n          });\n        } else {\n          throw new Error(response.message || '登录失败');\n        }\n      } catch (error) {\n        console.error('微信OAuth回调处理失败:', error);\n        const errorMessage = error instanceof Error ? error.message : '微信登录失败';\n        setError(errorMessage);\n        toast.error(errorMessage);\n\n        // 3秒后跳转到登录页面\n        setTimeout(() => {\n          navigate('/auth', {\n            replace: true\n          });\n        }, 3000);\n      } finally {\n        setIsProcessing(false);\n      }\n    };\n    handleCallback();\n  }, [searchParams, navigate, setUser, setToken]);\n\n  // 渲染加载状态\n  if (isProcessing) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"min-h-screen flex items-center justify-center bg-gray-50\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-semibold text-gray-900 mb-2\",\n          children: \"\\u6B63\\u5728\\u5904\\u7406\\u5FAE\\u4FE1\\u767B\\u5F55...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600\",\n          children: \"\\u8BF7\\u7A0D\\u5019\\uFF0C\\u6211\\u4EEC\\u6B63\\u5728\\u9A8C\\u8BC1\\u60A8\\u7684\\u8EAB\\u4EFD\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this);\n  }\n\n  // 渲染错误状态\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"min-h-screen flex items-center justify-center bg-gray-50\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center max-w-md mx-auto px-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-red-100 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-4\",\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"h-8 w-8 text-red-600\",\n            fill: \"none\",\n            viewBox: \"0 0 24 24\",\n            stroke: \"currentColor\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M6 18L18 6M6 6l12 12\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 93,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-semibold text-gray-900 mb-2\",\n          children: \"\\u767B\\u5F55\\u5931\\u8D25\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600 mb-4\",\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm text-gray-500\",\n          children: \"3\\u79D2\\u540E\\u5C06\\u81EA\\u52A8\\u8DF3\\u8F6C\\u5230\\u767B\\u5F55\\u9875\\u9762...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => navigate('/auth', {\n            replace: true\n          }),\n          className: \"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\",\n          children: \"\\u7ACB\\u5373\\u8FD4\\u56DE\\u767B\\u5F55\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }, this);\n  }\n\n  // 正常情况下不应该到达这里\n  return null;\n};\n_s(WechatCallbackPage, \"JrtJ4g4K8Fnm77YnUnPTrj5tlSI=\", false, function () {\n  return [useSearchParams, useNavigate, useAuth];\n});\n_c = WechatCallbackPage;\nexport default WechatCallbackPage;\nvar _c;\n$RefreshReg$(_c, \"WechatCallbackPage\");","map":{"version":3,"names":["React","useEffect","useState","useSearchParams","useNavigate","WechatOAuthService","useAuth","toast","jsxDEV","_jsxDEV","WechatCallbackPage","_s","searchParams","navigate","setUser","setToken","isProcessing","setIsProcessing","error","setError","handleCallback","code","get","state","errorParam","errorDescription","Error","response","success","data","user","token","redirectTo","localStorage","getItem","removeItem","replace","message","console","errorMessage","setTimeout","className","children","fileName","_jsxFileName","lineNumber","columnNumber","fill","viewBox","stroke","strokeLinecap","strokeLinejoin","strokeWidth","d","onClick","_c","$RefreshReg$"],"sources":["D:/project/trade/frontend/src/pages/WechatCallbackPage.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useSearchParams, useNavigate } from 'react-router-dom';\nimport { WechatOAuthService } from '../services/wechatOAuthService';\nimport { useAuth } from '../hooks/useAuth';\nimport { toast } from 'react-hot-toast';\n\n/**\n * 微信OAuth回调页面组件\n * 处理微信授权后的回调逻辑\n */\nconst WechatCallbackPage: React.FC = () => {\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  const { setUser, setToken } = useAuth();\n  const [isProcessing, setIsProcessing] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const handleCallback = async () => {\n      try {\n        // 从URL参数中获取授权码和状态\n        const code = searchParams.get('code');\n        const state = searchParams.get('state');\n        const errorParam = searchParams.get('error');\n        const errorDescription = searchParams.get('error_description');\n\n        // 检查是否有错误参数\n        if (errorParam) {\n          throw new Error(errorDescription || '微信授权失败');\n        }\n\n        // 检查必需参数\n        if (!code || !state) {\n          throw new Error('缺少必要的授权参数');\n        }\n\n        // 调用后端处理回调\n        const response = await WechatOAuthService.handleCallback(code, state);\n        \n        if (response.success && response.data) {\n          // 保存用户信息和令牌\n          setUser(response.data.user);\n          setToken(response.data.token);\n          \n          // 显示成功消息\n          toast.success('微信登录成功！');\n          \n          // 跳转到首页或用户指定的页面\n          const redirectTo = localStorage.getItem('wechat_redirect_after_login') || '/';\n          localStorage.removeItem('wechat_redirect_after_login');\n          navigate(redirectTo, { replace: true });\n        } else {\n          throw new Error(response.message || '登录失败');\n        }\n      } catch (error) {\n        console.error('微信OAuth回调处理失败:', error);\n        const errorMessage = error instanceof Error ? error.message : '微信登录失败';\n        setError(errorMessage);\n        toast.error(errorMessage);\n        \n        // 3秒后跳转到登录页面\n        setTimeout(() => {\n          navigate('/auth', { replace: true });\n        }, 3000);\n      } finally {\n        setIsProcessing(false);\n      }\n    };\n\n    handleCallback();\n  }, [searchParams, navigate, setUser, setToken]);\n\n  // 渲染加载状态\n  if (isProcessing) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">正在处理微信登录...</h2>\n          <p className=\"text-gray-600\">请稍候，我们正在验证您的身份</p>\n        </div>\n      </div>\n    );\n  }\n\n  // 渲染错误状态\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center max-w-md mx-auto px-4\">\n          <div className=\"bg-red-100 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-4\">\n            <svg className=\"h-8 w-8 text-red-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n            </svg>\n          </div>\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">登录失败</h2>\n          <p className=\"text-gray-600 mb-4\">{error}</p>\n          <p className=\"text-sm text-gray-500\">3秒后将自动跳转到登录页面...</p>\n          <button\n            onClick={() => navigate('/auth', { replace: true })}\n            className=\"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n          >\n            立即返回登录\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // 正常情况下不应该到达这里\n  return null;\n};\n\nexport default WechatCallbackPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}