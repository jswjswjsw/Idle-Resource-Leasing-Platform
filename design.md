# é—²ç½®èµ„æºç§Ÿèµå¹³å° - ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

**é¡¹ç›®åç§°**ï¼šé—²ç½®èµ„æºç§Ÿèµå¹³å°  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2024å¹´12æœˆ20æ—¥  
**æ–‡æ¡£çŠ¶æ€**ï¼šè®¾è®¡é˜¶æ®µ  
**è´Ÿè´£å›¢é˜Ÿ**ï¼šæŠ€æœ¯æ¶æ„ç»„  

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### 1. æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å±‚ (User Layer)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Webæµè§ˆå™¨      â”‚   ç§»åŠ¨ç«¯App      â”‚      ç®¡ç†åå°            â”‚
â”‚   (React)       â”‚ (React Native)  â”‚     (React Admin)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CDN + è´Ÿè½½å‡è¡¡å±‚                          â”‚
â”‚              é˜¿é‡Œäº‘CDN + SLB + Nginx                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APIç½‘å…³å±‚                              â”‚
â”‚            Kong Gateway + JWTè®¤è¯ + é™æµ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨æœåŠ¡å±‚ (å¾®æœåŠ¡)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·æœåŠ¡    â”‚  èµ„æºæœåŠ¡    â”‚  è®¢å•æœåŠ¡    â”‚     æ”¯ä»˜æœåŠ¡         â”‚
â”‚ (User API)  â”‚(Resource API)â”‚ (Order API) â”‚   (Payment API)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€šè®¯æœåŠ¡    â”‚  è¯„ä»·æœåŠ¡    â”‚  é€šçŸ¥æœåŠ¡    â”‚     æ–‡ä»¶æœåŠ¡         â”‚
â”‚  (Chat API) â”‚(Review API) â”‚(Notify API) â”‚    (File API)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å­˜å‚¨å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   MySQL     â”‚    Redis    â”‚Elasticsearchâ”‚      é˜¿é‡Œäº‘OSS       â”‚
â”‚  (ä¸»æ•°æ®åº“)   â”‚   (ç¼“å­˜)     â”‚  (æœç´¢å¼•æ“)   â”‚    (æ–‡ä»¶å­˜å‚¨)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç¬¬ä¸‰æ–¹æœåŠ¡å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ”¯ä»˜å®     â”‚   å¾®ä¿¡æ”¯ä»˜   â”‚   é«˜å¾·åœ°å›¾   â”‚      ç¯ä¿¡IM          â”‚
â”‚  (æ”¯ä»˜)     â”‚   (æ”¯ä»˜)     â”‚  (åœ°å›¾å®šä½)   â”‚    (å³æ—¶é€šè®¯)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é˜¿é‡Œäº‘çŸ­ä¿¡   â”‚  èŠéº»ä¿¡ç”¨    â”‚  é˜¿é‡Œäº‘æ¨é€   â”‚    é˜¿é‡Œäº‘å®äººè®¤è¯     â”‚
â”‚  (çŸ­ä¿¡éªŒè¯)   â”‚  (ä¿¡ç”¨è¯„ä¼°)   â”‚  (æ¶ˆæ¯æ¨é€)   â”‚    (èº«ä»½éªŒè¯)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å¾®æœåŠ¡æ¶æ„è®¾è®¡

#### 2.1 æœåŠ¡æ‹†åˆ†åŸåˆ™
- **ä¸šåŠ¡è¾¹ç•Œæ¸…æ™°**ï¼šæŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†æœåŠ¡
- **æ•°æ®ç‹¬ç«‹**ï¼šæ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“
- **æ¾è€¦åˆ**ï¼šæœåŠ¡é—´é€šè¿‡APIé€šä¿¡
- **é«˜å†…èš**ï¼šç›¸å…³åŠŸèƒ½èšåˆåœ¨åŒä¸€æœåŠ¡å†…

#### 2.2 æ ¸å¿ƒå¾®æœåŠ¡

```typescript
// æœåŠ¡æ³¨å†Œä¸­å¿ƒé…ç½®
interface ServiceRegistry {
  serviceName: string;
  version: string;
  host: string;
  port: number;
  healthCheck: string;
  tags: string[];
}

// ç”¨æˆ·æœåŠ¡ (User Service)
const userService: ServiceRegistry = {
  serviceName: 'user-service',
  version: '1.0.0',
  host: 'user-service.internal',
  port: 3001,
  healthCheck: '/health',
  tags: ['authentication', 'profile', 'credit']
};

// èµ„æºæœåŠ¡ (Resource Service)
const resourceService: ServiceRegistry = {
  serviceName: 'resource-service',
  version: '1.0.0',
  host: 'resource-service.internal',
  port: 3002,
  healthCheck: '/health',
  tags: ['resources', 'search', 'recommendation']
};

// è®¢å•æœåŠ¡ (Order Service)
const orderService: ServiceRegistry = {
  serviceName: 'order-service',
  version: '1.0.0',
  host: 'order-service.internal',
  port: 3003,
  healthCheck: '/health',
  tags: ['orders', 'booking', 'workflow']
};

// æ”¯ä»˜æœåŠ¡ (Payment Service)
const paymentService: ServiceRegistry = {
  serviceName: 'payment-service',
  version: '1.0.0',
  host: 'payment-service.internal',
  port: 3004,
  healthCheck: '/health',
  tags: ['payment', 'wallet', 'settlement']
};

// é€šè®¯æœåŠ¡ (Communication Service)
const communicationService: ServiceRegistry = {
  serviceName: 'communication-service',
  version: '1.0.0',
  host: 'communication-service.internal',
  port: 3005,
  healthCheck: '/health',
  tags: ['chat', 'notification', 'websocket']
};
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### 1. MySQL ä¸»æ•°æ®åº“è®¾è®¡

#### 1.1 ç”¨æˆ·ç›¸å…³è¡¨

```sql
-- ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨
CREATE TABLE `users` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
  `phone` varchar(20) NOT NULL COMMENT 'æ‰‹æœºå·',
  `email` varchar(100) DEFAULT NULL COMMENT 'é‚®ç®±',
  `nickname` varchar(50) NOT NULL COMMENT 'æ˜µç§°',
  `avatar` varchar(500) DEFAULT NULL COMMENT 'å¤´åƒURL',
  `gender` tinyint(1) DEFAULT 0 COMMENT 'æ€§åˆ«ï¼š0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³',
  `birthday` date DEFAULT NULL COMMENT 'ç”Ÿæ—¥',
  `real_name` varchar(50) DEFAULT NULL COMMENT 'çœŸå®å§“å',
  `id_card` varchar(18) DEFAULT NULL COMMENT 'èº«ä»½è¯å·',
  `id_card_verified` tinyint(1) DEFAULT 0 COMMENT 'èº«ä»½è¯æ˜¯å¦éªŒè¯',
  `face_verified` tinyint(1) DEFAULT 0 COMMENT 'äººè„¸æ˜¯å¦éªŒè¯',
  `credit_score` int(11) DEFAULT 600 COMMENT 'ä¿¡ç”¨åˆ†æ•°',
  `credit_level` varchar(20) DEFAULT 'BRONZE' COMMENT 'ä¿¡ç”¨ç­‰çº§',
  `status` tinyint(1) DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-æ­£å¸¸',
  `last_login_at` timestamp NULL DEFAULT NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_phone` (`phone`),
  UNIQUE KEY `uk_email` (`email`),
  KEY `idx_credit_score` (`credit_score`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨';

-- ç”¨æˆ·åœ°å€è¡¨
CREATE TABLE `user_addresses` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'åœ°å€ID',
  `user_id` bigint(20) unsigned NOT NULL COMMENT 'ç”¨æˆ·ID',
  `name` varchar(50) NOT NULL COMMENT 'æ”¶è´§äººå§“å',
  `phone` varchar(20) NOT NULL COMMENT 'è”ç³»ç”µè¯',
  `province` varchar(50) NOT NULL COMMENT 'çœä»½',
  `city` varchar(50) NOT NULL COMMENT 'åŸå¸‚',
  `district` varchar(50) NOT NULL COMMENT 'åŒºå¿',
  `address` varchar(200) NOT NULL COMMENT 'è¯¦ç»†åœ°å€',
  `longitude` decimal(10,7) DEFAULT NULL COMMENT 'ç»åº¦',
  `latitude` decimal(10,7) DEFAULT NULL COMMENT 'çº¬åº¦',
  `is_default` tinyint(1) DEFAULT 0 COMMENT 'æ˜¯å¦é»˜è®¤åœ°å€',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_location` (`longitude`, `latitude`),
  FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·åœ°å€è¡¨';

-- ç”¨æˆ·é’±åŒ…è¡¨
CREATE TABLE `user_wallets` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'é’±åŒ…ID',
  `user_id` bigint(20) unsigned NOT NULL COMMENT 'ç”¨æˆ·ID',
  `balance` decimal(10,2) DEFAULT 0.00 COMMENT 'ä½™é¢',
  `frozen_amount` decimal(10,2) DEFAULT 0.00 COMMENT 'å†»ç»“é‡‘é¢',
  `total_income` decimal(10,2) DEFAULT 0.00 COMMENT 'æ€»æ”¶å…¥',
  `total_expense` decimal(10,2) DEFAULT 0.00 COMMENT 'æ€»æ”¯å‡º',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_id` (`user_id`),
  FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·é’±åŒ…è¡¨';
```

#### 1.2 èµ„æºç›¸å…³è¡¨

```sql
-- èµ„æºåˆ†ç±»è¡¨
CREATE TABLE `resource_categories` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'åˆ†ç±»ID',
  `parent_id` int(11) unsigned DEFAULT 0 COMMENT 'çˆ¶åˆ†ç±»ID',
  `name` varchar(50) NOT NULL COMMENT 'åˆ†ç±»åç§°',
  `icon` varchar(200) DEFAULT NULL COMMENT 'åˆ†ç±»å›¾æ ‡',
  `sort_order` int(11) DEFAULT 0 COMMENT 'æ’åº',
  `status` tinyint(1) DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_parent_id` (`parent_id`),
  KEY `idx_sort_order` (`sort_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='èµ„æºåˆ†ç±»è¡¨';

-- èµ„æºä¿¡æ¯è¡¨
CREATE TABLE `resources` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'èµ„æºID',
  `user_id` bigint(20) unsigned NOT NULL COMMENT 'å‘å¸ƒç”¨æˆ·ID',
  `category_id` int(11) unsigned NOT NULL COMMENT 'åˆ†ç±»ID',
  `title` varchar(100) NOT NULL COMMENT 'èµ„æºæ ‡é¢˜',
  `description` text COMMENT 'èµ„æºæè¿°',
  `specifications` json DEFAULT NULL COMMENT 'è§„æ ¼å‚æ•°',
  `images` json DEFAULT NULL COMMENT 'å›¾ç‰‡åˆ—è¡¨',
  `videos` json DEFAULT NULL COMMENT 'è§†é¢‘åˆ—è¡¨',
  `daily_price` decimal(8,2) NOT NULL COMMENT 'æ—¥ç§Ÿé‡‘',
  `hourly_price` decimal(8,2) DEFAULT NULL COMMENT 'æ—¶ç§Ÿé‡‘',
  `deposit` decimal(8,2) NOT NULL COMMENT 'æŠ¼é‡‘',
  `original_price` decimal(10,2) DEFAULT NULL COMMENT 'åŸä»·',
  `condition_score` tinyint(1) DEFAULT 5 COMMENT 'æˆè‰²è¯„åˆ†(1-5)',
  `location_province` varchar(50) NOT NULL COMMENT 'æ‰€åœ¨çœä»½',
  `location_city` varchar(50) NOT NULL COMMENT 'æ‰€åœ¨åŸå¸‚',
  `location_district` varchar(50) NOT NULL COMMENT 'æ‰€åœ¨åŒºå¿',
  `location_address` varchar(200) DEFAULT NULL COMMENT 'è¯¦ç»†åœ°å€',
  `longitude` decimal(10,7) DEFAULT NULL COMMENT 'ç»åº¦',
  `latitude` decimal(10,7) DEFAULT NULL COMMENT 'çº¬åº¦',
  `delivery_methods` json DEFAULT NULL COMMENT 'äº¤ä»˜æ–¹å¼',
  `available_start_date` date DEFAULT NULL COMMENT 'å¯ç§Ÿå¼€å§‹æ—¥æœŸ',
  `available_end_date` date DEFAULT NULL COMMENT 'å¯ç§Ÿç»“æŸæ—¥æœŸ',
  `available_time_slots` json DEFAULT NULL COMMENT 'å¯ç§Ÿæ—¶é—´æ®µ',
  `tags` json DEFAULT NULL COMMENT 'æ ‡ç­¾',
  `view_count` int(11) DEFAULT 0 COMMENT 'æµè§ˆæ¬¡æ•°',
  `favorite_count` int(11) DEFAULT 0 COMMENT 'æ”¶è—æ¬¡æ•°',
  `order_count` int(11) DEFAULT 0 COMMENT 'è®¢å•æ¬¡æ•°',
  `rating` decimal(3,2) DEFAULT 5.00 COMMENT 'è¯„åˆ†',
  `rating_count` int(11) DEFAULT 0 COMMENT 'è¯„ä»·æ•°é‡',
  `status` varchar(20) DEFAULT 'DRAFT' COMMENT 'çŠ¶æ€ï¼šDRAFT-è‰ç¨¿ï¼ŒPUBLISHED-å·²å‘å¸ƒï¼ŒRENTED-å·²å‡ºç§Ÿï¼ŒOFFLINE-ä¸‹çº¿',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_category_id` (`category_id`),
  KEY `idx_location` (`longitude`, `latitude`),
  KEY `idx_price` (`daily_price`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`),
  FULLTEXT KEY `ft_title_desc` (`title`, `description`),
  FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  FOREIGN KEY (`category_id`) REFERENCES `resource_categories` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='èµ„æºä¿¡æ¯è¡¨';
```

#### 1.3 è®¢å•ç›¸å…³è¡¨

```sql
-- è®¢å•è¡¨
CREATE TABLE `orders` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'è®¢å•ID',
  `order_no` varchar(32) NOT NULL COMMENT 'è®¢å•å·',
  `resource_id` bigint(20) unsigned NOT NULL COMMENT 'èµ„æºID',
  `renter_id` bigint(20) unsigned NOT NULL COMMENT 'ç§Ÿå®¢ID',
  `owner_id` bigint(20) unsigned NOT NULL COMMENT 'å‡ºç§Ÿæ–¹ID',
  `rental_start_date` datetime NOT NULL COMMENT 'ç§Ÿèµå¼€å§‹æ—¶é—´',
  `rental_end_date` datetime NOT NULL COMMENT 'ç§Ÿèµç»“æŸæ—¶é—´',
  `rental_days` int(11) NOT NULL COMMENT 'ç§Ÿèµå¤©æ•°',
  `rental_hours` int(11) DEFAULT NULL COMMENT 'ç§Ÿèµå°æ—¶æ•°',
  `daily_price` decimal(8,2) NOT NULL COMMENT 'æ—¥ç§Ÿé‡‘',
  `hourly_price` decimal(8,2) DEFAULT NULL COMMENT 'æ—¶ç§Ÿé‡‘',
  `total_rent` decimal(10,2) NOT NULL COMMENT 'æ€»ç§Ÿé‡‘',
  `deposit` decimal(8,2) NOT NULL COMMENT 'æŠ¼é‡‘',
  `service_fee` decimal(8,2) DEFAULT 0.00 COMMENT 'æœåŠ¡è´¹',
  `delivery_fee` decimal(8,2) DEFAULT 0.00 COMMENT 'é…é€è´¹',
  `insurance_fee` decimal(8,2) DEFAULT 0.00 COMMENT 'ä¿é™©è´¹',
  `total_amount` decimal(10,2) NOT NULL COMMENT 'è®¢å•æ€»é‡‘é¢',
  `delivery_method` varchar(20) NOT NULL COMMENT 'äº¤ä»˜æ–¹å¼',
  `delivery_address` json DEFAULT NULL COMMENT 'é…é€åœ°å€',
  `pickup_address` json DEFAULT NULL COMMENT 'è‡ªæåœ°å€',
  `renter_notes` text COMMENT 'ç§Ÿå®¢å¤‡æ³¨',
  `owner_notes` text COMMENT 'å‡ºç§Ÿæ–¹å¤‡æ³¨',
  `status` varchar(20) DEFAULT 'PENDING' COMMENT 'è®¢å•çŠ¶æ€',
  `cancel_reason` varchar(200) DEFAULT NULL COMMENT 'å–æ¶ˆåŸå› ',
  `cancelled_by` bigint(20) unsigned DEFAULT NULL COMMENT 'å–æ¶ˆäººID',
  `cancelled_at` timestamp NULL DEFAULT NULL COMMENT 'å–æ¶ˆæ—¶é—´',
  `confirmed_at` timestamp NULL DEFAULT NULL COMMENT 'ç¡®è®¤æ—¶é—´',
  `delivered_at` timestamp NULL DEFAULT NULL COMMENT 'äº¤ä»˜æ—¶é—´',
  `returned_at` timestamp NULL DEFAULT NULL COMMENT 'å½’è¿˜æ—¶é—´',
  `completed_at` timestamp NULL DEFAULT NULL COMMENT 'å®Œæˆæ—¶é—´',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`),
  KEY `idx_resource_id` (`resource_id`),
  KEY `idx_renter_id` (`renter_id`),
  KEY `idx_owner_id` (`owner_id`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`),
  FOREIGN KEY (`resource_id`) REFERENCES `resources` (`id`),
  FOREIGN KEY (`renter_id`) REFERENCES `users` (`id`),
  FOREIGN KEY (`owner_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è®¢å•è¡¨';

-- æ”¯ä»˜è®°å½•è¡¨
CREATE TABLE `payments` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'æ”¯ä»˜ID',
  `payment_no` varchar(32) NOT NULL COMMENT 'æ”¯ä»˜å•å·',
  `order_id` bigint(20) unsigned NOT NULL COMMENT 'è®¢å•ID',
  `user_id` bigint(20) unsigned NOT NULL COMMENT 'æ”¯ä»˜ç”¨æˆ·ID',
  `payment_type` varchar(20) NOT NULL COMMENT 'æ”¯ä»˜ç±»å‹ï¼šRENT-ç§Ÿé‡‘ï¼ŒDEPOSIT-æŠ¼é‡‘ï¼ŒREFUND-é€€æ¬¾',
  `payment_method` varchar(20) NOT NULL COMMENT 'æ”¯ä»˜æ–¹å¼',
  `amount` decimal(10,2) NOT NULL COMMENT 'æ”¯ä»˜é‡‘é¢',
  `currency` varchar(3) DEFAULT 'CNY' COMMENT 'è´§å¸ç±»å‹',
  `third_party_no` varchar(64) DEFAULT NULL COMMENT 'ç¬¬ä¸‰æ–¹æ”¯ä»˜å•å·',
  `status` varchar(20) DEFAULT 'PENDING' COMMENT 'æ”¯ä»˜çŠ¶æ€',
  `paid_at` timestamp NULL DEFAULT NULL COMMENT 'æ”¯ä»˜æ—¶é—´',
  `refunded_at` timestamp NULL DEFAULT NULL COMMENT 'é€€æ¬¾æ—¶é—´',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_payment_no` (`payment_no`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`),
  FOREIGN KEY (`order_id`) REFERENCES `orders` (`id`),
  FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ”¯ä»˜è®°å½•è¡¨';
```

### 2. Redis ç¼“å­˜è®¾è®¡

#### 2.1 ç¼“å­˜ç­–ç•¥

```typescript
// Redis ç¼“å­˜é”®è®¾è®¡è§„èŒƒ
interface CacheKeyPattern {
  pattern: string;
  ttl: number; // è¿‡æœŸæ—¶é—´(ç§’)
  description: string;
}

// ç¼“å­˜é”®æ¨¡å¼å®šä¹‰
const cacheKeys: Record<string, CacheKeyPattern> = {
  // ç”¨æˆ·ç›¸å…³ç¼“å­˜
  USER_INFO: {
    pattern: 'user:info:{userId}',
    ttl: 3600, // 1å°æ—¶
    description: 'ç”¨æˆ·åŸºç¡€ä¿¡æ¯ç¼“å­˜'
  },
  USER_SESSION: {
    pattern: 'user:session:{sessionId}',
    ttl: 86400, // 24å°æ—¶
    description: 'ç”¨æˆ·ä¼šè¯ç¼“å­˜'
  },
  USER_CREDIT: {
    pattern: 'user:credit:{userId}',
    ttl: 1800, // 30åˆ†é’Ÿ
    description: 'ç”¨æˆ·ä¿¡ç”¨ä¿¡æ¯ç¼“å­˜'
  },
  
  // èµ„æºç›¸å…³ç¼“å­˜
  RESOURCE_INFO: {
    pattern: 'resource:info:{resourceId}',
    ttl: 1800, // 30åˆ†é’Ÿ
    description: 'èµ„æºè¯¦æƒ…ç¼“å­˜'
  },
  RESOURCE_LIST: {
    pattern: 'resource:list:{categoryId}:{page}:{filters}',
    ttl: 300, // 5åˆ†é’Ÿ
    description: 'èµ„æºåˆ—è¡¨ç¼“å­˜'
  },
  HOT_RESOURCES: {
    pattern: 'resource:hot:{cityCode}',
    ttl: 600, // 10åˆ†é’Ÿ
    description: 'çƒ­é—¨èµ„æºç¼“å­˜'
  },
  
  // æœç´¢ç›¸å…³ç¼“å­˜
  SEARCH_RESULT: {
    pattern: 'search:result:{keyword}:{filters}:{page}',
    ttl: 300, // 5åˆ†é’Ÿ
    description: 'æœç´¢ç»“æœç¼“å­˜'
  },
  SEARCH_SUGGESTIONS: {
    pattern: 'search:suggestions:{keyword}',
    ttl: 3600, // 1å°æ—¶
    description: 'æœç´¢å»ºè®®ç¼“å­˜'
  },
  
  // è®¢å•ç›¸å…³ç¼“å­˜
  ORDER_INFO: {
    pattern: 'order:info:{orderId}',
    ttl: 1800, // 30åˆ†é’Ÿ
    description: 'è®¢å•è¯¦æƒ…ç¼“å­˜'
  },
  USER_ORDERS: {
    pattern: 'order:user:{userId}:{status}:{page}',
    ttl: 300, // 5åˆ†é’Ÿ
    description: 'ç”¨æˆ·è®¢å•åˆ—è¡¨ç¼“å­˜'
  },
  
  // åœ°ç†ä½ç½®ç¼“å­˜
  GEO_RESOURCES: {
    pattern: 'geo:resources:{longitude}:{latitude}:{radius}',
    ttl: 600, // 10åˆ†é’Ÿ
    description: 'åœ°ç†ä½ç½®èµ„æºç¼“å­˜'
  },
  
  // ç»Ÿè®¡æ•°æ®ç¼“å­˜
  STATS_DAILY: {
    pattern: 'stats:daily:{date}',
    ttl: 86400, // 24å°æ—¶
    description: 'æ¯æ—¥ç»Ÿè®¡æ•°æ®ç¼“å­˜'
  },
  
  // é™æµç¼“å­˜
  RATE_LIMIT: {
    pattern: 'rate:limit:{userId}:{action}',
    ttl: 3600, // 1å°æ—¶
    description: 'ç”¨æˆ·æ“ä½œé™æµç¼“å­˜'
  }
};

// ç¼“å­˜ç®¡ç†å™¨
class CacheManager {
  private redis: Redis;
  
  constructor(redis: Redis) {
    this.redis = redis;
  }
  
  /**
   * ç”Ÿæˆç¼“å­˜é”®
   * @param pattern ç¼“å­˜é”®æ¨¡å¼
   * @param params å‚æ•°å¯¹è±¡
   */
  generateKey(pattern: string, params: Record<string, string>): string {
    let key = pattern;
    Object.entries(params).forEach(([param, value]) => {
      key = key.replace(`{${param}}`, value);
    });
    return key;
  }
  
  /**
   * è®¾ç½®ç¼“å­˜
   * @param keyType ç¼“å­˜é”®ç±»å‹
   * @param params å‚æ•°
   * @param data æ•°æ®
   */
  async set(keyType: string, params: Record<string, string>, data: any): Promise<void> {
    const config = cacheKeys[keyType];
    if (!config) throw new Error(`Unknown cache key type: ${keyType}`);
    
    const key = this.generateKey(config.pattern, params);
    await this.redis.setex(key, config.ttl, JSON.stringify(data));
  }
  
  /**
   * è·å–ç¼“å­˜
   * @param keyType ç¼“å­˜é”®ç±»å‹
   * @param params å‚æ•°
   */
  async get<T>(keyType: string, params: Record<string, string>): Promise<T | null> {
    const config = cacheKeys[keyType];
    if (!config) throw new Error(`Unknown cache key type: ${keyType}`);
    
    const key = this.generateKey(config.pattern, params);
    const data = await this.redis.get(key);
    return data ? JSON.parse(data) : null;
  }
  
  /**
   * åˆ é™¤ç¼“å­˜
   * @param keyType ç¼“å­˜é”®ç±»å‹
   * @param params å‚æ•°
   */
  async delete(keyType: string, params: Record<string, string>): Promise<void> {
    const config = cacheKeys[keyType];
    if (!config) throw new Error(`Unknown cache key type: ${keyType}`);
    
    const key = this.generateKey(config.pattern, params);
    await this.redis.del(key);
  }
  
  /**
   * æ‰¹é‡åˆ é™¤ç¼“å­˜
   * @param pattern åŒ¹é…æ¨¡å¼
   */
  async deleteByPattern(pattern: string): Promise<void> {
    const keys = await this.redis.keys(pattern);
    if (keys.length > 0) {
      await this.redis.del(...keys);
    }
  }
}
```

### 3. Elasticsearch æœç´¢è®¾è®¡

#### 3.1 ç´¢å¼•ç»“æ„è®¾è®¡

```json
{
  "mappings": {
    "properties": {
      "id": {
        "type": "long"
      },
      "title": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart",
        "fields": {
          "keyword": {
            "type": "keyword"
          }
        }
      },
      "description": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart"
      },
      "category_id": {
        "type": "integer"
      },
      "category_name": {
        "type": "keyword"
      },
      "daily_price": {
        "type": "float"
      },
      "deposit": {
        "type": "float"
      },
      "condition_score": {
        "type": "integer"
      },
      "location": {
        "type": "geo_point"
      },
      "location_city": {
        "type": "keyword"
      },
      "location_district": {
        "type": "keyword"
      },
      "tags": {
        "type": "keyword"
      },
      "rating": {
        "type": "float"
      },
      "rating_count": {
        "type": "integer"
      },
      "view_count": {
        "type": "integer"
      },
      "order_count": {
        "type": "integer"
      },
      "status": {
        "type": "keyword"
      },
      "created_at": {
        "type": "date"
      },
      "updated_at": {
        "type": "date"
      },
      "owner_id": {
        "type": "long"
      },
      "owner_credit_score": {
        "type": "integer"
      },
      "available_dates": {
        "type": "date_range"
      }
    }
  },
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1,
    "analysis": {
      "analyzer": {
        "ik_max_word": {
          "type": "ik_max_word"
        },
        "ik_smart": {
          "type": "ik_smart"
        }
      }
    }
  }
}
```

---

## ğŸ”Œ APIæ¥å£è®¾è®¡

### 1. RESTful API è§„èŒƒ

#### 1.1 API è®¾è®¡åŸåˆ™
- **RESTfulé£æ ¼**ï¼šä½¿ç”¨æ ‡å‡†HTTPæ–¹æ³•
- **ç»Ÿä¸€å“åº”æ ¼å¼**ï¼šæ ‡å‡†åŒ–çš„å“åº”ç»“æ„
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šé€šè¿‡URLè·¯å¾„è¿›è¡Œç‰ˆæœ¬ç®¡ç†
- **çŠ¶æ€ç è§„èŒƒ**ï¼šä½¿ç”¨æ ‡å‡†HTTPçŠ¶æ€ç 
- **åˆ†é¡µæŸ¥è¯¢**ï¼šç»Ÿä¸€çš„åˆ†é¡µå‚æ•°å’Œå“åº”

#### 1.2 é€šç”¨å“åº”æ ¼å¼

```typescript
// ç»Ÿä¸€å“åº”æ¥å£
interface ApiResponse<T = any> {
  code: number;           // ä¸šåŠ¡çŠ¶æ€ç 
  message: string;        // å“åº”æ¶ˆæ¯
  data?: T;              // å“åº”æ•°æ®
  timestamp: number;      // æ—¶é—´æˆ³
  requestId: string;      // è¯·æ±‚ID
}

// åˆ†é¡µå“åº”æ¥å£
interface PaginationResponse<T> {
  items: T[];            // æ•°æ®åˆ—è¡¨
  total: number;         // æ€»æ•°é‡
  page: number;          // å½“å‰é¡µç 
  pageSize: number;      // æ¯é¡µå¤§å°
  totalPages: number;    // æ€»é¡µæ•°
  hasNext: boolean;      // æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
  hasPrev: boolean;      // æ˜¯å¦æœ‰ä¸Šä¸€é¡µ
}

// é”™è¯¯å“åº”æ¥å£
interface ErrorResponse {
  code: number;
  message: string;
  details?: any;
  timestamp: number;
  requestId: string;
  path: string;
}
```

#### 1.3 æ ¸å¿ƒAPIæ¥å£

```typescript
// ç”¨æˆ·è®¤è¯ç›¸å…³API
namespace AuthAPI {
  // å‘é€éªŒè¯ç 
  interface SendSmsRequest {
    phone: string;
    type: 'register' | 'login' | 'reset_password';
  }
  
  // æ‰‹æœºå·æ³¨å†Œ
  interface RegisterRequest {
    phone: string;
    smsCode: string;
    password: string;
    nickname: string;
    inviteCode?: string;
  }
  
  // ç™»å½•è¯·æ±‚
  interface LoginRequest {
    phone?: string;
    email?: string;
    password?: string;
    smsCode?: string;
    loginType: 'password' | 'sms' | 'wechat' | 'alipay';
    thirdPartyCode?: string;
  }
  
  // ç™»å½•å“åº”
  interface LoginResponse {
    accessToken: string;
    refreshToken: string;
    expiresIn: number;
    user: UserProfile;
  }
  
  // ç”¨æˆ·èµ„æ–™
  interface UserProfile {
    id: number;
    phone: string;
    email?: string;
    nickname: string;
    avatar?: string;
    gender: number;
    birthday?: string;
    realName?: string;
    idCardVerified: boolean;
    faceVerified: boolean;
    creditScore: number;
    creditLevel: string;
    status: number;
  }
}

// èµ„æºç®¡ç†ç›¸å…³API
namespace ResourceAPI {
  // èµ„æºæœç´¢è¯·æ±‚
  interface SearchRequest {
    keyword?: string;
    categoryId?: number;
    cityCode?: string;
    longitude?: number;
    latitude?: number;
    radius?: number; // æœç´¢åŠå¾„(km)
    minPrice?: number;
    maxPrice?: number;
    minRating?: number;
    conditionScore?: number;
    tags?: string[];
    sortBy?: 'price' | 'distance' | 'rating' | 'created_at';
    sortOrder?: 'asc' | 'desc';
    page?: number;
    pageSize?: number;
  }
  
  // èµ„æºè¯¦æƒ…
  interface ResourceDetail {
    id: number;
    userId: number;
    categoryId: number;
    categoryName: string;
    title: string;
    description: string;
    specifications: Record<string, any>;
    images: string[];
    videos: string[];
    dailyPrice: number;
    hourlyPrice?: number;
    deposit: number;
    originalPrice?: number;
    conditionScore: number;
    location: {
      province: string;
      city: string;
      district: string;
      address?: string;
      longitude?: number;
      latitude?: number;
    };
    deliveryMethods: string[];
    availableStartDate?: string;
    availableEndDate?: string;
    availableTimeSlots?: any[];
    tags: string[];
    viewCount: number;
    favoriteCount: number;
    orderCount: number;
    rating: number;
    ratingCount: number;
    status: string;
    owner: {
      id: number;
      nickname: string;
      avatar?: string;
      creditScore: number;
      creditLevel: string;
    };
    createdAt: string;
    updatedAt: string;
  }
  
  // å‘å¸ƒèµ„æºè¯·æ±‚
  interface PublishRequest {
    categoryId: number;
    title: string;
    description: string;
    specifications?: Record<string, any>;
    images: string[];
    videos?: string[];
    dailyPrice: number;
    hourlyPrice?: number;
    deposit: number;
    originalPrice?: number;
    conditionScore: number;
    locationProvince: string;
    locationCity: string;
    locationDistrict: string;
    locationAddress?: string;
    longitude?: number;
    latitude?: number;
    deliveryMethods: string[];
    availableStartDate?: string;
    availableEndDate?: string;
    availableTimeSlots?: any[];
    tags?: string[];
  }
}

// è®¢å•ç®¡ç†ç›¸å…³API
namespace OrderAPI {
  // åˆ›å»ºè®¢å•è¯·æ±‚
  interface CreateOrderRequest {
    resourceId: number;
    rentalStartDate: string;
    rentalEndDate: string;
    deliveryMethod: string;
    deliveryAddress?: {
      name: string;
      phone: string;
      province: string;
      city: string;
      district: string;
      address: string;
    };
    renterNotes?: string;
  }
  
  // è®¢å•è¯¦æƒ…
  interface OrderDetail {
    id: number;
    orderNo: string;
    resourceId: number;
    resource: {
      id: number;
      title: string;
      images: string[];
      dailyPrice: number;
      hourlyPrice?: number;
    };
    renterId: number;
    renter: {
      id: number;
      nickname: string;
      avatar?: string;
      phone: string;
    };
    ownerId: number;
    owner: {
      id: number;
      nickname: string;
      avatar?: string;
      phone: string;
    };
    rentalStartDate: string;
    rentalEndDate: string;
    rentalDays: number;
    rentalHours?: number;
    totalRent: number;
    deposit: number;
    serviceFee: number;
    deliveryFee: number;
    insuranceFee: number;
    totalAmount: number;
    deliveryMethod: string;
    deliveryAddress?: any;
    pickupAddress?: any;
    renterNotes?: string;
    ownerNotes?: string;
    status: string;
    cancelReason?: string;
    cancelledBy?: number;
    cancelledAt?: string;
    confirmedAt?: string;
    deliveredAt?: string;
    returnedAt?: string;
    completedAt?: string;
    createdAt: string;
    updatedAt: string;
  }
}
```

### 2. WebSocket å®æ—¶é€šä¿¡è®¾è®¡

#### 2.1 WebSocket è¿æ¥ç®¡ç†

```typescript
// WebSocket æ¶ˆæ¯ç±»å‹å®šä¹‰
interface WebSocketMessage {
  type: string;
  data: any;
  timestamp: number;
  messageId: string;
}

// èŠå¤©æ¶ˆæ¯
interface ChatMessage extends WebSocketMessage {
  type: 'chat_message';
  data: {
    conversationId: string;
    senderId: number;
    receiverId: number;
    messageType: 'text' | 'image' | 'voice' | 'file' | 'location';
    content: string;
    metadata?: any;
  };
}

// è®¢å•çŠ¶æ€æ›´æ–°
interface OrderStatusUpdate extends WebSocketMessage {
  type: 'order_status_update';
  data: {
    orderId: number;
    status: string;
    message: string;
  };
}

// ç³»ç»Ÿé€šçŸ¥
interface SystemNotification extends WebSocketMessage {
  type: 'system_notification';
  data: {
    title: string;
    content: string;
    notificationType: 'info' | 'warning' | 'error' | 'success';
    actionUrl?: string;
  };
}

// WebSocket è¿æ¥ç®¡ç†å™¨
class WebSocketManager {
  private connections: Map<number, WebSocket> = new Map();
  private userRooms: Map<number, Set<string>> = new Map();
  
  /**
   * ç”¨æˆ·è¿æ¥
   * @param userId ç”¨æˆ·ID
   * @param ws WebSocketè¿æ¥
   */
  connect(userId: number, ws: WebSocket): void {
    this.connections.set(userId, ws);
    
    // åŠ å…¥ç”¨æˆ·ä¸ªäººæˆ¿é—´
    this.joinRoom(userId, `user_${userId}`);
    
    ws.on('close', () => {
      this.disconnect(userId);
    });
    
    ws.on('message', (data) => {
      this.handleMessage(userId, data);
    });
  }
  
  /**
   * ç”¨æˆ·æ–­å¼€è¿æ¥
   * @param userId ç”¨æˆ·ID
   */
  disconnect(userId: number): void {
    this.connections.delete(userId);
    this.userRooms.delete(userId);
  }
  
  /**
   * åŠ å…¥æˆ¿é—´
   * @param userId ç”¨æˆ·ID
   * @param roomId æˆ¿é—´ID
   */
  joinRoom(userId: number, roomId: string): void {
    if (!this.userRooms.has(userId)) {
      this.userRooms.set(userId, new Set());
    }
    this.userRooms.get(userId)!.add(roomId);
  }
  
  /**
   * ç¦»å¼€æˆ¿é—´
   * @param userId ç”¨æˆ·ID
   * @param roomId æˆ¿é—´ID
   */
  leaveRoom(userId: number, roomId: string): void {
    const rooms = this.userRooms.get(userId);
    if (rooms) {
      rooms.delete(roomId);
    }
  }
  
  /**
   * å‘é€æ¶ˆæ¯ç»™æŒ‡å®šç”¨æˆ·
   * @param userId ç”¨æˆ·ID
   * @param message æ¶ˆæ¯
   */
  sendToUser(userId: number, message: WebSocketMessage): void {
    const ws = this.connections.get(userId);
    if (ws && ws.readyState === WebSocket.OPEN) {
      ws.send(JSON.stringify(message));
    }
  }
  
  /**
   * å‘é€æ¶ˆæ¯ç»™æˆ¿é—´å†…æ‰€æœ‰ç”¨æˆ·
   * @param roomId æˆ¿é—´ID
   * @param message æ¶ˆæ¯
   */
  sendToRoom(roomId: string, message: WebSocketMessage): void {
    this.userRooms.forEach((rooms, userId) => {
      if (rooms.has(roomId)) {
        this.sendToUser(userId, message);
      }
    });
  }
  
  /**
   * å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯
   * @param userId ç”¨æˆ·ID
   * @param data æ¶ˆæ¯æ•°æ®
   */
  private handleMessage(userId: number, data: any): void {
    try {
      const message: WebSocketMessage = JSON.parse(data.toString());
      
      switch (message.type) {
        case 'chat_message':
          this.handleChatMessage(userId, message as ChatMessage);
          break;
        case 'join_room':
          this.joinRoom(userId, message.data.roomId);
          break;
        case 'leave_room':
          this.leaveRoom(userId, message.data.roomId);
          break;
        case 'ping':
          this.sendToUser(userId, { type: 'pong', data: {}, timestamp: Date.now(), messageId: message.messageId });
          break;
      }
    } catch (error) {
      console.error('WebSocket message parse error:', error);
    }
  }
  
  /**
   * å¤„ç†èŠå¤©æ¶ˆæ¯
   * @param senderId å‘é€è€…ID
   * @param message èŠå¤©æ¶ˆæ¯
   */
  private async handleChatMessage(senderId: number, message: ChatMessage): Promise<void> {
    // ä¿å­˜æ¶ˆæ¯åˆ°æ•°æ®åº“
    await this.saveChatMessage(message.data);
    
    // è½¬å‘æ¶ˆæ¯ç»™æ¥æ”¶è€…
    this.sendToUser(message.data.receiverId, message);
    
    // å‘é€æ¨é€é€šçŸ¥
    await this.sendPushNotification(message.data.receiverId, {
      title: 'æ–°æ¶ˆæ¯',
      body: message.data.content,
      data: {
        type: 'chat',
        conversationId: message.data.conversationId
      }
    });
  }
  
  /**
   * ä¿å­˜èŠå¤©æ¶ˆæ¯
   * @param messageData æ¶ˆæ¯æ•°æ®
   */
  private async saveChatMessage(messageData: any): Promise<void> {
    // å®ç°æ¶ˆæ¯ä¿å­˜é€»è¾‘
  }
  
  /**
   * å‘é€æ¨é€é€šçŸ¥
   * @param userId ç”¨æˆ·ID
   * @param notification é€šçŸ¥å†…å®¹
   */
  private async sendPushNotification(userId: number, notification: any): Promise<void> {
    // å®ç°æ¨é€é€šçŸ¥é€»è¾‘
  }
}
```

---

## ğŸ¨ å‰ç«¯æ¶æ„è®¾è®¡

### 1. Webå‰ç«¯æ¶æ„

#### 1.1 é¡¹ç›®ç»“æ„

```
web-frontend/
â”œâ”€â”€ public/                     # é™æ€èµ„æº
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ manifest.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/             # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/            # åŸºç¡€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”‚   â”œâ”€â”€ Input/
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal/
â”‚   â”‚   â”‚   â””â”€â”€ Loading/
â”‚   â”‚   â”œâ”€â”€ business/          # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ResourceCard/
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderCard/
â”‚   â”‚   â”‚   â”œâ”€â”€ UserAvatar/
â”‚   â”‚   â”‚   â””â”€â”€ ChatWindow/
â”‚   â”‚   â””â”€â”€ layout/            # å¸ƒå±€ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ Header/
â”‚   â”‚       â”œâ”€â”€ Footer/
â”‚   â”‚       â”œâ”€â”€ Sidebar/
â”‚   â”‚       â””â”€â”€ Layout/
â”‚   â”œâ”€â”€ pages/                 # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Home/             # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ Search/           # æœç´¢é¡µ
â”‚   â”‚   â”œâ”€â”€ Resource/         # èµ„æºç›¸å…³é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ List/
â”‚   â”‚   â”‚   â”œâ”€â”€ Detail/
â”‚   â”‚   â”‚   â””â”€â”€ Publish/
â”‚   â”‚   â”œâ”€â”€ Order/            # è®¢å•ç›¸å…³é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ List/
â”‚   â”‚   â”‚   â”œâ”€â”€ Detail/
â”‚   â”‚   â”‚   â””â”€â”€ Create/
â”‚   â”‚   â”œâ”€â”€ User/             # ç”¨æˆ·ç›¸å…³é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Profile/
â”‚   â”‚   â”‚   â”œâ”€â”€ Settings/
â”‚   â”‚   â”‚   â””â”€â”€ Wallet/
â”‚   â”‚   â””â”€â”€ Auth/             # è®¤è¯ç›¸å…³é¡µé¢
â”‚   â”‚       â”œâ”€â”€ Login/
â”‚   â”‚       â”œâ”€â”€ Register/
â”‚   â”‚       â””â”€â”€ ForgotPassword/
â”‚   â”œâ”€â”€ hooks/                # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useWebSocket.ts
â”‚   â”‚   â”œâ”€â”€ useGeolocation.ts
â”‚   â”‚   â””â”€â”€ useDebounce.ts
â”‚   â”œâ”€â”€ store/                # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ slices/
â”‚   â”‚   â”‚   â”œâ”€â”€ authSlice.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ resourceSlice.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ orderSlice.ts
â”‚   â”‚   â”‚   â””â”€â”€ chatSlice.ts
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ authApi.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ resourceApi.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ orderApi.ts
â”‚   â”‚   â”‚   â””â”€â”€ userApi.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ services/             # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ api.ts           # APIé…ç½®
â”‚   â”‚   â”œâ”€â”€ websocket.ts     # WebSocketæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ geolocation.ts   # åœ°ç†ä½ç½®æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ payment.ts       # æ”¯ä»˜æœåŠ¡
â”‚   â”‚   â””â”€â”€ upload.ts        # æ–‡ä»¶ä¸Šä¼ æœåŠ¡
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ format.ts        # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚   â”œâ”€â”€ validation.ts    # éªŒè¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ storage.ts       # å­˜å‚¨å·¥å…·
â”‚   â”‚   â””â”€â”€ constants.ts     # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ styles/              # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”œâ”€â”€ variables.css
â”‚   â”‚   â””â”€â”€ themes/
â”‚   â”œâ”€â”€ types/               # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ resource.ts
â”‚   â”‚   â””â”€â”€ order.ts
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ index.tsx
â”‚   â””â”€â”€ setupTests.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ README.md
```

#### 1.2 æ ¸å¿ƒç»„ä»¶è®¾è®¡

```typescript
// èµ„æºå¡ç‰‡ç»„ä»¶
import React from 'react';
import { Card, Image, Tag, Rate, Button } from 'antd';
import { HeartOutlined, EnvironmentOutlined } from '@ant-design/icons';
import { Resource } from '@/types/resource';
import { formatPrice, formatDistance } from '@/utils/format';

interface ResourceCardProps {
  resource: Resource;
  onFavorite?: (resourceId: number) => void;
  onView?: (resourceId: number) => void;
  className?: string;
}

/**
 * èµ„æºå¡ç‰‡ç»„ä»¶
 * ç”¨äºå±•ç¤ºèµ„æºçš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€æ ‡é¢˜ã€ä»·æ ¼ã€è¯„åˆ†ç­‰
 */
const ResourceCard: React.FC<ResourceCardProps> = ({
  resource,
  onFavorite,
  onView,
  className
}) => {
  // å¤„ç†æ”¶è—æ“ä½œ
  const handleFavorite = (e: React.MouseEvent) => {
    e.stopPropagation();
    onFavorite?.(resource.id);
  };
  
  // å¤„ç†æŸ¥çœ‹è¯¦æƒ…
  const handleView = () => {
    onView?.(resource.id);
  };
  
  return (
    <Card
      className={`resource-card ${className || ''}`}
      hoverable
      cover={
        <div className="resource-card-cover">
          <Image
            src={resource.images[0]}
            alt={resource.title}
            preview={false}
            fallback="/images/placeholder.png"
          />
          <div className="resource-card-overlay">
            <Button
              type="text"
              icon={<HeartOutlined />}
              className="favorite-btn"
              onClick={handleFavorite}
            />
          </div>
        </div>
      }
      onClick={handleView}
    >
      <div className="resource-card-content">
        {/* æ ‡é¢˜ */}
        <h3 className="resource-title" title={resource.title}>
          {resource.title}
        </h3>
        
        {/* ä»·æ ¼ */}
        <div className="resource-price">
          <span className="daily-price">
            Â¥{formatPrice(resource.dailyPrice)}/å¤©
          </span>
          {resource.hourlyPrice && (
            <span className="hourly-price">
              Â¥{formatPrice(resource.hourlyPrice)}/æ—¶
            </span>
          )}
        </div>
        
        {/* ä½ç½®ä¿¡æ¯ */}
        <div className="resource-location">
          <EnvironmentOutlined />
          <span>{resource.location.district}</span>
          {resource.distance && (
            <span className="distance">
              {formatDistance(resource.distance)}
            </span>
          )}
        </div>
        
        {/* è¯„åˆ†å’Œæ ‡ç­¾ */}
        <div className="resource-meta">
          <Rate
            disabled
            allowHalf
            value={resource.rating}
            className="resource-rating"
          />
          <span className="rating-count">
            ({resource.ratingCount})
          </span>
        </div>
        
        {/* æ ‡ç­¾ */}
        {resource.tags && resource.tags.length > 0 && (
          <div className="resource-tags">
            {resource.tags.slice(0, 3).map((tag, index) => (
              <Tag key={index} size="small">
                {tag}
              </Tag>
            ))}
          </div>
        )}
      </div>
    </Card>
  );
};

export default ResourceCard;
```

#### 1.3 çŠ¶æ€ç®¡ç†è®¾è®¡

```typescript
// Redux Toolkit çŠ¶æ€ç®¡ç†
import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';
import { resourceApi } from '@/store/api/resourceApi';
import { Resource, ResourceSearchParams } from '@/types/resource';

// å¼‚æ­¥æ“ä½œï¼šæœç´¢èµ„æº
export const searchResources = createAsyncThunk(
  'resource/searchResources',
  async (params: ResourceSearchParams) => {
    const response = await resourceApi.search(params);
    return response.data;
  }
);

// å¼‚æ­¥æ“ä½œï¼šè·å–èµ„æºè¯¦æƒ…
export const getResourceDetail = createAsyncThunk(
  'resource/getResourceDetail',
  async (resourceId: number) => {
    const response = await resourceApi.getDetail(resourceId);
    return response.data;
  }
);

// èµ„æºçŠ¶æ€æ¥å£
interface ResourceState {
  // æœç´¢ç›¸å…³
  searchParams: ResourceSearchParams;
  searchResults: Resource[];
  searchTotal: number;
  searchLoading: boolean;
  searchError: string | null;
  
  // è¯¦æƒ…ç›¸å…³
  currentResource: Resource | null;
  detailLoading: boolean;
  detailError: string | null;
  
  // æ”¶è—åˆ—è¡¨
  favorites: number[];
  
  // åˆ†ç±»æ•°æ®
  categories: any[];
  
  // çƒ­é—¨æ¨è
  hotResources: Resource[];
  
  // æœ€è¿‘æµè§ˆ
  recentViewed: Resource[];
}

// åˆå§‹çŠ¶æ€
const initialState: ResourceState = {
  searchParams: {
    keyword: '',
    categoryId: undefined,
    page: 1,
    pageSize: 20
  },
  searchResults: [],
  searchTotal: 0,
  searchLoading: false,
  searchError: null,
  currentResource: null,
  detailLoading: false,
  detailError: null,
  favorites: [],
  categories: [],
  hotResources: [],
  recentViewed: []
};

// åˆ›å»ºèµ„æºåˆ‡ç‰‡
const resourceSlice = createSlice({
  name: 'resource',
  initialState,
  reducers: {
    // æ›´æ–°æœç´¢å‚æ•°
    updateSearchParams: (state, action: PayloadAction<Partial<ResourceSearchParams>>) => {
      state.searchParams = { ...state.searchParams, ...action.payload };
    },
    
    // æ¸…ç©ºæœç´¢ç»“æœ
    clearSearchResults: (state) => {
      state.searchResults = [];
      state.searchTotal = 0;
    },
    
    // æ·»åŠ åˆ°æ”¶è—
    addToFavorites: (state, action: PayloadAction<number>) => {
      if (!state.favorites.includes(action.payload)) {
        state.favorites.push(action.payload);
      }
    },
    
    // ä»æ”¶è—ä¸­ç§»é™¤
    removeFromFavorites: (state, action: PayloadAction<number>) => {
      state.favorites = state.favorites.filter(id => id !== action.payload);
    },
    
    // æ·»åŠ åˆ°æœ€è¿‘æµè§ˆ
    addToRecentViewed: (state, action: PayloadAction<Resource>) => {
      const resource = action.payload;
      // ç§»é™¤å·²å­˜åœ¨çš„è®°å½•
      state.recentViewed = state.recentViewed.filter(item => item.id !== resource.id);
      // æ·»åŠ åˆ°å¼€å¤´
      state.recentViewed.unshift(resource);
      // é™åˆ¶æœ€å¤šä¿å­˜20æ¡è®°å½•
      if (state.recentViewed.length > 20) {
        state.recentViewed = state.recentViewed.slice(0, 20);
      }
    },
    
    // è®¾ç½®åˆ†ç±»æ•°æ®
    setCategories: (state, action: PayloadAction<any[]>) => {
      state.categories = action.payload;
    },
    
    // è®¾ç½®çƒ­é—¨èµ„æº
    setHotResources: (state, action: PayloadAction<Resource[]>) => {
      state.hotResources = action.payload;
    }
  },
  
  // å¤„ç†å¼‚æ­¥æ“ä½œ
  extraReducers: (builder) => {
    // æœç´¢èµ„æº
    builder
      .addCase(searchResources.pending, (state) => {
        state.searchLoading = true;
        state.searchError = null;
      })
      .addCase(searchResources.fulfilled, (state, action) => {
        state.searchLoading = false;
        state.searchResults = action.payload.items;
        state.searchTotal = action.payload.total;
      })
      .addCase(searchResources.rejected, (state, action) => {
        state.searchLoading = false;
        state.searchError = action.error.message || 'æœç´¢å¤±è´¥';
      })
      // è·å–èµ„æºè¯¦æƒ…
      .addCase(getResourceDetail.pending, (state) => {
        state.detailLoading = true;
        state.detailError = null;
      })
      .addCase(getResourceDetail.fulfilled, (state, action) => {
        state.detailLoading = false;
        state.currentResource = action.payload;
        // æ·»åŠ åˆ°æœ€è¿‘æµè§ˆ
        resourceSlice.caseReducers.addToRecentViewed(state, {
          type: 'resource/addToRecentViewed',
          payload: action.payload
        });
      })
      .addCase(getResourceDetail.rejected, (state, action) => {
        state.detailLoading = false;
        state.detailError = action.error.message || 'è·å–è¯¦æƒ…å¤±è´¥';
      });
  }
});

// å¯¼å‡ºactions
export const {
  updateSearchParams,
  clearSearchResults,
  addToFavorites,
  removeFromFavorites,
  addToRecentViewed,
  setCategories,
  setHotResources
} = resourceSlice.actions;

// å¯¼å‡ºreducer
export default resourceSlice.reducer;

// é€‰æ‹©å™¨
export const selectSearchResults = (state: RootState) => state.resource.searchResults;
export const selectSearchLoading = (state: RootState) => state.resource.searchLoading;
export const selectCurrentResource = (state: RootState) => state.resource.currentResource;
export const selectFavorites = (state: RootState) => state.resource.favorites;
export const selectHotResources = (state: RootState) => state.resource.hotResources;
```

### 2. ç§»åŠ¨ç«¯æ¶æ„è®¾è®¡

#### 2.1 React Native é¡¹ç›®ç»“æ„

```
mobile-app/
â”œâ”€â”€ android/                   # AndroidåŸç”Ÿä»£ç 
â”œâ”€â”€ ios/                      # iOSåŸç”Ÿä»£ç 
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/           # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/          # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”‚   â”œâ”€â”€ Input/
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal/
â”‚   â”‚   â”‚   â””â”€â”€ Loading/
â”‚   â”‚   â”œâ”€â”€ business/        # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ResourceCard/
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderCard/
â”‚   â”‚   â”‚   â””â”€â”€ ChatBubble/
â”‚   â”‚   â””â”€â”€ navigation/      # å¯¼èˆªç»„ä»¶
â”‚   â”œâ”€â”€ screens/             # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ Home/
â”‚   â”‚   â”œâ”€â”€ Search/
â”‚   â”‚   â”œâ”€â”€ Resource/
â”‚   â”‚   â”œâ”€â”€ Order/
â”‚   â”‚   â”œâ”€â”€ Chat/
â”‚   â”‚   â”œâ”€â”€ Profile/
â”‚   â”‚   â””â”€â”€ Auth/
â”‚   â”œâ”€â”€ navigation/          # å¯¼èˆªé…ç½®
â”‚   â”‚   â”œâ”€â”€ AppNavigator.tsx
â”‚   â”‚   â”œâ”€â”€ AuthNavigator.tsx
â”‚   â”‚   â””â”€â”€ TabNavigator.tsx
â”‚   â”œâ”€â”€ store/              # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ slices/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ services/           # æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ location.ts
â”‚   â”‚   â”œâ”€â”€ notification.ts
â”‚   â”‚   â””â”€â”€ storage.ts
â”‚   â”œâ”€â”€ utils/              # å·¥å…·
â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ types/              # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ constants/          # å¸¸é‡
â”œâ”€â”€ package.json
â”œâ”€â”€ metro.config.js
â”œâ”€â”€ babel.config.js
â””â”€â”€ README.md
```

#### 2.2 ç§»åŠ¨ç«¯æ ¸å¿ƒåŠŸèƒ½å®ç°

```typescript
// åœ°ç†ä½ç½®æœåŠ¡
import Geolocation from '@react-native-community/geolocation';
import { PermissionsAndroid, Platform } from 'react-native';

interface LocationCoords {
  latitude: number;
  longitude: number;
  accuracy: number;
}

class LocationService {
  /**
   * è¯·æ±‚ä½ç½®æƒé™
   */
  static async requestLocationPermission(): Promise<boolean> {
    if (Platform.OS === 'android') {
      try {
        const granted = await PermissionsAndroid.request(
          PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION,
          {
            title: 'ä½ç½®æƒé™',
            message: 'åº”ç”¨éœ€è¦è®¿é—®æ‚¨çš„ä½ç½®ä¿¡æ¯ä»¥æä¾›é™„è¿‘çš„èµ„æº',
            buttonNeutral: 'ç¨åè¯¢é—®',
            buttonNegative: 'å–æ¶ˆ',
            buttonPositive: 'ç¡®å®š',
          }
        );
        return granted === PermissionsAndroid.RESULTS.GRANTED;
      } catch (err) {
        console.warn(err);
        return false;
      }
    }
    return true;
  }
  
  /**
   * è·å–å½“å‰ä½ç½®
   */
  static async getCurrentPosition(): Promise<LocationCoords> {
    const hasPermission = await this.requestLocationPermission();
    if (!hasPermission) {
      throw new Error('ä½ç½®æƒé™è¢«æ‹’ç»');
    }
    
    return new Promise((resolve, reject) => {
      Geolocation.getCurrentPosition(
        (position) => {
          resolve({
            latitude: position.coords.latitude,
            longitude: position.coords.longitude,
            accuracy: position.coords.accuracy
          });
        },
        (error) => {
          reject(new Error(`è·å–ä½ç½®å¤±è´¥: ${error.message}`));
        },
        {
          enableHighAccuracy: true,
          timeout: 15000,
          maximumAge: 10000
        }
      );
    });
  }
  
  /**
   * ç›‘å¬ä½ç½®å˜åŒ–
   */
  static watchPosition(
    onLocationChange: (coords: LocationCoords) => void,
    onError?: (error: Error) => void
  ): number {
    return Geolocation.watchPosition(
      (position) => {
        onLocationChange({
          latitude: position.coords.latitude,
          longitude: position.coords.longitude,
          accuracy: position.coords.accuracy
        });
      },
      (error) => {
        onError?.(new Error(`ä½ç½®ç›‘å¬å¤±è´¥: ${error.message}`));
      },
      {
        enableHighAccuracy: true,
        distanceFilter: 10, // 10ç±³å˜åŒ–æ‰è§¦å‘
        interval: 5000,     // 5ç§’é—´éš”
        fastestInterval: 2000
      }
    );
  }
  
  /**
   * åœæ­¢ä½ç½®ç›‘å¬
   */
  static clearWatch(watchId: number): void {
    Geolocation.clearWatch(watchId);
  }
}

export default LocationService;
```

---

## ğŸ”’ å®‰å…¨è®¾è®¡

### 1. èº«ä»½è®¤è¯ä¸æˆæƒ

#### 1.1 JWTè®¤è¯æœºåˆ¶

```typescript
// JWTè®¤è¯æœåŠ¡
import jwt from 'jsonwebtoken';
import bcrypt from 'bcrypt';
import { Redis } from 'ioredis';

interface JWTPayload {
  userId: number;
  phone: string;
  role: string;
  sessionId: string;
}

interface TokenPair {
  accessToken: string;
  refreshToken: string;
  expiresIn: number;
}

class AuthService {
  private redis: Redis;
  private accessTokenSecret: string;
  private refreshTokenSecret: string;
  private accessTokenExpiry: string = '15m';  // è®¿é—®ä»¤ç‰Œ15åˆ†é’Ÿè¿‡æœŸ
  private refreshTokenExpiry: string = '7d';  // åˆ·æ–°ä»¤ç‰Œ7å¤©è¿‡æœŸ
  
  constructor(redis: Redis) {
    this.redis = redis;
    this.accessTokenSecret = process.env.JWT_ACCESS_SECRET!;
    this.refreshTokenSecret = process.env.JWT_REFRESH_SECRET!;
  }
  
  /**
   * ç”Ÿæˆå¯†ç å“ˆå¸Œ
   * @param password æ˜æ–‡å¯†ç 
   */
  async hashPassword(password: string): Promise<string> {
    const saltRounds = 12;
    return bcrypt.hash(password, saltRounds);
  }
  
  /**
   * éªŒè¯å¯†ç 
   * @param password æ˜æ–‡å¯†ç 
   * @param hashedPassword å“ˆå¸Œå¯†ç 
   */
  async verifyPassword(password: string, hashedPassword: string): Promise<boolean> {
    return bcrypt.compare(password, hashedPassword);
  }
  
  /**
   * ç”Ÿæˆä»¤ç‰Œå¯¹
   * @param payload JWTè½½è·
   */
  async generateTokenPair(payload: JWTPayload): Promise<TokenPair> {
    // ç”Ÿæˆè®¿é—®ä»¤ç‰Œ
    const accessToken = jwt.sign(
      payload,
      this.accessTokenSecret,
      { expiresIn: this.accessTokenExpiry }
    );
    
    // ç”Ÿæˆåˆ·æ–°ä»¤ç‰Œ
    const refreshToken = jwt.sign(
      { userId: payload.userId, sessionId: payload.sessionId },
      this.refreshTokenSecret,
      { expiresIn: this.refreshTokenExpiry }
    );
    
    // å°†åˆ·æ–°ä»¤ç‰Œå­˜å‚¨åˆ°Redis
    const refreshTokenKey = `refresh_token:${payload.userId}:${payload.sessionId}`;
    await this.redis.setex(refreshTokenKey, 7 * 24 * 3600, refreshToken);
    
    // å­˜å‚¨ç”¨æˆ·ä¼šè¯ä¿¡æ¯
    const sessionKey = `user_session:${payload.sessionId}`;
    await this.redis.setex(sessionKey, 7 * 24 * 3600, JSON.stringify({
      userId: payload.userId,
      phone: payload.phone,
      role: payload.role,
      loginTime: new Date().toISOString(),
      lastActivity: new Date().toISOString()
    }));
    
    return {
      accessToken,
      refreshToken,
      expiresIn: 15 * 60 // 15åˆ†é’Ÿ
    };
  }
  
  /**
   * éªŒè¯è®¿é—®ä»¤ç‰Œ
   * @param token è®¿é—®ä»¤ç‰Œ
   */
  async verifyAccessToken(token: string): Promise<JWTPayload | null> {
    try {
      const payload = jwt.verify(token, this.accessTokenSecret) as JWTPayload;
      
      // æ£€æŸ¥ä¼šè¯æ˜¯å¦æœ‰æ•ˆ
      const sessionKey = `user_session:${payload.sessionId}`;
      const sessionData = await this.redis.get(sessionKey);
      
      if (!sessionData) {
        return null; // ä¼šè¯å·²è¿‡æœŸæˆ–æ— æ•ˆ
      }
      
      // æ›´æ–°æœ€åæ´»åŠ¨æ—¶é—´
      const session = JSON.parse(sessionData);
      session.lastActivity = new Date().toISOString();
      await this.redis.setex(sessionKey, 7 * 24 * 3600, JSON.stringify(session));
      
      return payload;
    } catch (error) {
      return null;
    }
  }
  
  /**
   * åˆ·æ–°è®¿é—®ä»¤ç‰Œ
   * @param refreshToken åˆ·æ–°ä»¤ç‰Œ
   */
  async refreshAccessToken(refreshToken: string): Promise<TokenPair | null> {
    try {
      const payload = jwt.verify(refreshToken, this.refreshTokenSecret) as {
        userId: number;
        sessionId: string;
      };
      
      // éªŒè¯åˆ·æ–°ä»¤ç‰Œæ˜¯å¦å­˜åœ¨äºRedisä¸­
      const refreshTokenKey = `refresh_token:${payload.userId}:${payload.sessionId}`;
      const storedToken = await this.redis.get(refreshTokenKey);
      
      if (storedToken !== refreshToken) {
        return null; // åˆ·æ–°ä»¤ç‰Œæ— æ•ˆ
      }
      
      // è·å–ç”¨æˆ·ä¿¡æ¯
      const sessionKey = `user_session:${payload.sessionId}`;
      const sessionData = await this.redis.get(sessionKey);
      
      if (!sessionData) {
        return null; // ä¼šè¯å·²è¿‡æœŸ
      }
      
      const session = JSON.parse(sessionData);
      
      // ç”Ÿæˆæ–°çš„ä»¤ç‰Œå¯¹
      return this.generateTokenPair({
        userId: payload.userId,
        phone: session.phone,
        role: session.role,
        sessionId: payload.sessionId
      });
    } catch (error) {
      return null;
    }
  }
  
  /**
   * æ³¨é”€ç”¨æˆ·
   * @param sessionId ä¼šè¯ID
   * @param userId ç”¨æˆ·ID
   */
  async logout(sessionId: string, userId: number): Promise<void> {
    // åˆ é™¤åˆ·æ–°ä»¤ç‰Œ
    const refreshTokenKey = `refresh_token:${userId}:${sessionId}`;
    await this.redis.del(refreshTokenKey);
    
    // åˆ é™¤ä¼šè¯ä¿¡æ¯
    const sessionKey = `user_session:${sessionId}`;
    await this.redis.del(sessionKey);
  }
  
  /**
   * æ³¨é”€ç”¨æˆ·æ‰€æœ‰ä¼šè¯
   * @param userId ç”¨æˆ·ID
   */
  async logoutAllSessions(userId: number): Promise<void> {
    // æŸ¥æ‰¾ç”¨æˆ·æ‰€æœ‰ä¼šè¯
    const pattern = `refresh_token:${userId}:*`;
    const keys = await this.redis.keys(pattern);
    
    if (keys.length > 0) {
      // åˆ é™¤æ‰€æœ‰åˆ·æ–°ä»¤ç‰Œ
      await this.redis.del(...keys);
      
      // åˆ é™¤å¯¹åº”çš„ä¼šè¯ä¿¡æ¯
      const sessionKeys = keys.map(key => {
        const sessionId = key.split(':')[2];
        return `user_session:${sessionId}`;
      });
      
      await this.redis.del(...sessionKeys);
    }
  }
}

export default AuthService;
```

#### 1.2 æƒé™æ§åˆ¶ä¸­é—´ä»¶

```typescript
// æƒé™æ§åˆ¶ä¸­é—´ä»¶
import { Request, Response, NextFunction } from 'express';
import AuthService from '../services/auth.service';
import { Redis } from 'ioredis';

interface AuthenticatedRequest extends Request {
  user?: {
    userId: number;
    phone: string;
    role: string;
    sessionId: string;
  };
}

class AuthMiddleware {
  private authService: AuthService;
  
  constructor(redis: Redis) {
    this.authService = new AuthService(redis);
  }
  
  /**
   * JWTè®¤è¯ä¸­é—´ä»¶
   */
  authenticate = async (
    req: AuthenticatedRequest,
    res: Response,
    next: NextFunction
  ): Promise<void> => {
    try {
      const authHeader = req.headers.authorization;
      
      if (!authHeader || !authHeader.startsWith('Bearer ')) {
        res.status(401).json({
          success: false,
          message: 'ç¼ºå°‘è®¤è¯ä»¤ç‰Œ'
        });
        return;
      }
      
      const token = authHeader.substring(7); // ç§»é™¤ 'Bearer ' å‰ç¼€
      const payload = await this.authService.verifyAccessToken(token);
      
      if (!payload) {
        res.status(401).json({
          success: false,
          message: 'æ— æ•ˆçš„è®¤è¯ä»¤ç‰Œ'
        });
        return;
      }
      
      // å°†ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°è¯·æ±‚å¯¹è±¡
      req.user = {
        userId: payload.userId,
        phone: payload.phone,
        role: payload.role,
        sessionId: payload.sessionId
      };
      
      next();
    } catch (error) {
      res.status(500).json({
        success: false,
        message: 'è®¤è¯æœåŠ¡å¼‚å¸¸'
      });
    }
  };
  
  /**
   * è§’è‰²æƒé™æ£€æŸ¥
   * @param allowedRoles å…è®¸çš„è§’è‰²åˆ—è¡¨
   */
  authorize = (allowedRoles: string[]) => {
    return (req: AuthenticatedRequest, res: Response, next: NextFunction): void => {
      if (!req.user) {
        res.status(401).json({
          success: false,
          message: 'ç”¨æˆ·æœªè®¤è¯'
        });
        return;
      }
      
      if (!allowedRoles.includes(req.user.role)) {
        res.status(403).json({
          success: false,
          message: 'æƒé™ä¸è¶³'
        });
        return;
      }
      
      next();
    };
  };
  
  /**
   * èµ„æºæ‰€æœ‰è€…æ£€æŸ¥
   * @param resourceIdParam èµ„æºIDå‚æ•°å
   * @param resourceType èµ„æºç±»å‹
   */
  checkResourceOwnership = (resourceIdParam: string, resourceType: 'resource' | 'order') => {
    return async (req: AuthenticatedRequest, res: Response, next: NextFunction): Promise<void> => {
      try {
        if (!req.user) {
          res.status(401).json({
            success: false,
            message: 'ç”¨æˆ·æœªè®¤è¯'
          });
          return;
        }
        
        const resourceId = parseInt(req.params[resourceIdParam]);
        if (isNaN(resourceId)) {
          res.status(400).json({
            success: false,
            message: 'æ— æ•ˆçš„èµ„æºID'
          });
          return;
        }
        
        // è¿™é‡Œéœ€è¦æ ¹æ®å®é™…çš„æ•°æ®åº“æŸ¥è¯¢æ¥éªŒè¯æ‰€æœ‰æƒ
        // ç¤ºä¾‹ä»£ç ï¼Œå®é™…å®ç°éœ€è¦æ³¨å…¥æ•°æ®åº“æœåŠ¡
        const isOwner = await this.checkOwnership(req.user.userId, resourceId, resourceType);
        
        if (!isOwner && req.user.role !== 'admin') {
          res.status(403).json({
            success: false,
            message: 'æ— æƒè®¿é—®æ­¤èµ„æº'
          });
          return;
        }
        
        next();
      } catch (error) {
        res.status(500).json({
          success: false,
          message: 'æƒé™æ£€æŸ¥å¤±è´¥'
        });
      }
    };
  };
  
  /**
   * æ£€æŸ¥èµ„æºæ‰€æœ‰æƒï¼ˆéœ€è¦æ³¨å…¥æ•°æ®åº“æœåŠ¡ï¼‰
   */
  private async checkOwnership(
    userId: number,
    resourceId: number,
    resourceType: 'resource' | 'order'
  ): Promise<boolean> {
    // å®é™…å®ç°éœ€è¦æŸ¥è¯¢æ•°æ®åº“
    // è¿™é‡Œåªæ˜¯ç¤ºä¾‹
    return true;
  }
}

export default AuthMiddleware;
```

### 2. æ•°æ®åŠ å¯†

#### 2.1 æ•æ„Ÿæ•°æ®åŠ å¯†æœåŠ¡

```typescript
// æ•°æ®åŠ å¯†æœåŠ¡
import crypto from 'crypto';

interface EncryptionResult {
  encryptedData: string;
  iv: string;
}

class EncryptionService {
  private algorithm: string = 'aes-256-gcm';
  private secretKey: Buffer;
  
  constructor() {
    // ä»ç¯å¢ƒå˜é‡è·å–å¯†é’¥ï¼Œå®é™…éƒ¨ç½²æ—¶åº”ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡
    const key = process.env.ENCRYPTION_KEY;
    if (!key) {
      throw new Error('ç¼ºå°‘åŠ å¯†å¯†é’¥');
    }
    this.secretKey = crypto.scryptSync(key, 'salt', 32);
  }
  
  /**
   * åŠ å¯†æ•æ„Ÿæ•°æ®
   * @param plaintext æ˜æ–‡æ•°æ®
   */
  encrypt(plaintext: string): EncryptionResult {
    const iv = crypto.randomBytes(16);
    const cipher = crypto.createCipher(this.algorithm, this.secretKey);
    cipher.setAAD(Buffer.from('additional-data'));
    
    let encrypted = cipher.update(plaintext, 'utf8', 'hex');
    encrypted += cipher.final('hex');
    
    const authTag = cipher.getAuthTag();
    
    return {
      encryptedData: encrypted + ':' + authTag.toString('hex'),
      iv: iv.toString('hex')
    };
  }
  
  /**
   * è§£å¯†æ•æ„Ÿæ•°æ®
   * @param encryptedData åŠ å¯†æ•°æ®
   * @param iv åˆå§‹åŒ–å‘é‡
   */
  decrypt(encryptedData: string, iv: string): string {
    const [encrypted, authTagHex] = encryptedData.split(':');
    const authTag = Buffer.from(authTagHex, 'hex');
    const ivBuffer = Buffer.from(iv, 'hex');
    
    const decipher = crypto.createDecipher(this.algorithm, this.secretKey);
    decipher.setAAD(Buffer.from('additional-data'));
    decipher.setAuthTag(authTag);
    
    let decrypted = decipher.update(encrypted, 'hex', 'utf8');
    decrypted += decipher.final('utf8');
    
    return decrypted;
  }
  
  /**
   * ç”Ÿæˆå“ˆå¸Œå€¼ï¼ˆç”¨äºæ•°æ®å®Œæ•´æ€§æ ¡éªŒï¼‰
   * @param data åŸå§‹æ•°æ®
   */
  generateHash(data: string): string {
    return crypto.createHash('sha256').update(data).digest('hex');
  }
  
  /**
   * éªŒè¯å“ˆå¸Œå€¼
   * @param data åŸå§‹æ•°æ®
   * @param hash å“ˆå¸Œå€¼
   */
  verifyHash(data: string, hash: string): boolean {
    const computedHash = this.generateHash(data);
    return crypto.timingSafeEqual(
      Buffer.from(computedHash, 'hex'),
      Buffer.from(hash, 'hex')
    );
  }
  
  /**
   * ç”Ÿæˆéšæœºä»¤ç‰Œ
   * @param length ä»¤ç‰Œé•¿åº¦
   */
  generateToken(length: number = 32): string {
    return crypto.randomBytes(length).toString('hex');
  }
}

export default EncryptionService;
```

### 3. APIå®‰å…¨é˜²æŠ¤

#### 3.1 è¯·æ±‚é¢‘ç‡é™åˆ¶

```typescript
// é¢‘ç‡é™åˆ¶ä¸­é—´ä»¶
import { Request, Response, NextFunction } from 'express';
import { Redis } from 'ioredis';

interface RateLimitOptions {
  windowMs: number;     // æ—¶é—´çª—å£ï¼ˆæ¯«ç§’ï¼‰
  maxRequests: number;  // æœ€å¤§è¯·æ±‚æ•°
  message?: string;     // é™åˆ¶æ¶ˆæ¯
  skipSuccessfulRequests?: boolean; // è·³è¿‡æˆåŠŸè¯·æ±‚
  skipFailedRequests?: boolean;     // è·³è¿‡å¤±è´¥è¯·æ±‚
}

class RateLimitMiddleware {
  private redis: Redis;
  
  constructor(redis: Redis) {
    this.redis = redis;
  }
  
  /**
   * åˆ›å»ºé¢‘ç‡é™åˆ¶ä¸­é—´ä»¶
   * @param options é™åˆ¶é€‰é¡¹
   */
  createRateLimit = (options: RateLimitOptions) => {
    return async (req: Request, res: Response, next: NextFunction): Promise<void> => {
      try {
        // è·å–å®¢æˆ·ç«¯æ ‡è¯†ï¼ˆIPåœ°å€æˆ–ç”¨æˆ·IDï¼‰
        const identifier = this.getClientIdentifier(req);
        const key = `rate_limit:${identifier}:${req.route?.path || req.path}`;
        
        // è·å–å½“å‰è¯·æ±‚è®¡æ•°
        const current = await this.redis.get(key);
        const requestCount = current ? parseInt(current) : 0;
        
        // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶
        if (requestCount >= options.maxRequests) {
          // è·å–é‡ç½®æ—¶é—´
          const ttl = await this.redis.ttl(key);
          
          res.status(429).json({
            success: false,
            message: options.message || 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•',
            retryAfter: ttl > 0 ? ttl : Math.ceil(options.windowMs / 1000)
          });
          return;
        }
        
        // å¢åŠ è¯·æ±‚è®¡æ•°
        const pipeline = this.redis.pipeline();
        pipeline.incr(key);
        
        // è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆä»…åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼‰
        if (requestCount === 0) {
          pipeline.expire(key, Math.ceil(options.windowMs / 1000));
        }
        
        await pipeline.exec();
        
        // æ·»åŠ å“åº”å¤´
        res.set({
          'X-RateLimit-Limit': options.maxRequests.toString(),
          'X-RateLimit-Remaining': Math.max(0, options.maxRequests - requestCount - 1).toString(),
          'X-RateLimit-Reset': new Date(Date.now() + options.windowMs).toISOString()
        });
        
        next();
      } catch (error) {
        console.error('é¢‘ç‡é™åˆ¶ä¸­é—´ä»¶é”™è¯¯:', error);
        next(); // å‘ç”Ÿé”™è¯¯æ—¶ä¸é˜»æ­¢è¯·æ±‚
      }
    };
  };
  
  /**
   * è·å–å®¢æˆ·ç«¯æ ‡è¯†
   */
  private getClientIdentifier(req: Request): string {
    // ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·IDï¼ˆå¦‚æœå·²è®¤è¯ï¼‰
    const user = (req as any).user;
    if (user?.userId) {
      return `user:${user.userId}`;
    }
    
    // ä½¿ç”¨IPåœ°å€
    return `ip:${req.ip || req.connection.remoteAddress || 'unknown'}`;
  }
  
  /**
   * ç™»å½•é¢‘ç‡é™åˆ¶ï¼ˆæ›´ä¸¥æ ¼ï¼‰
   */
  loginRateLimit = this.createRateLimit({
    windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
    maxRequests: 5,           // æœ€å¤š5æ¬¡å°è¯•
    message: 'ç™»å½•å°è¯•è¿‡äºé¢‘ç¹ï¼Œè¯·15åˆ†é’Ÿåå†è¯•'
  });
  
  /**
   * APIé¢‘ç‡é™åˆ¶ï¼ˆä¸€èˆ¬ï¼‰
   */
  apiRateLimit = this.createRateLimit({
    windowMs: 60 * 1000,      // 1åˆ†é’Ÿ
    maxRequests: 100,         // æœ€å¤š100æ¬¡è¯·æ±‚
    message: 'APIè¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•'
  });
  
  /**
   * æœç´¢é¢‘ç‡é™åˆ¶
   */
  searchRateLimit = this.createRateLimit({
    windowMs: 60 * 1000,      // 1åˆ†é’Ÿ
    maxRequests: 30,          // æœ€å¤š30æ¬¡æœç´¢
    message: 'æœç´¢è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•'
  });
}

export default RateLimitMiddleware;
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### 1. é˜¿é‡Œäº‘æ¶æ„è®¾è®¡

#### 1.1 äº‘æœåŠ¡æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é˜¿é‡Œäº‘æ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CDN (å…¨çƒåŠ é€Ÿ)                                              â”‚
â”‚  â”œâ”€â”€ é™æ€èµ„æºç¼“å­˜                                            â”‚
â”‚  â””â”€â”€ å›¾ç‰‡/è§†é¢‘åŠ é€Ÿ                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SLB (è´Ÿè½½å‡è¡¡)                                              â”‚
â”‚  â”œâ”€â”€ HTTPSç»ˆç»“                                              â”‚
â”‚  â”œâ”€â”€ å¥åº·æ£€æŸ¥                                               â”‚
â”‚  â””â”€â”€ æµé‡åˆ†å‘                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ECSé›†ç¾¤ (å¼¹æ€§è®¡ç®—)                                          â”‚
â”‚  â”œâ”€â”€ WebæœåŠ¡å™¨ (Nginx)                                      â”‚
â”‚  â”œâ”€â”€ APIæœåŠ¡å™¨ (Node.js)                                    â”‚
â”‚  â”œâ”€â”€ WebSocketæœåŠ¡å™¨                                        â”‚
â”‚  â””â”€â”€ å®šæ—¶ä»»åŠ¡æœåŠ¡å™¨                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å±‚                                                      â”‚
â”‚  â”œâ”€â”€ RDS MySQL (ä¸»ä»å¤åˆ¶)                                   â”‚
â”‚  â”œâ”€â”€ Redisé›†ç¾¤ (ç¼“å­˜/ä¼šè¯)                                   â”‚
â”‚  â”œâ”€â”€ Elasticsearch (æœç´¢)                                   â”‚
â”‚  â””â”€â”€ OSS (å¯¹è±¡å­˜å‚¨)                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç›‘æ§ä¸å®‰å…¨                                                  â”‚
â”‚  â”œâ”€â”€ CloudMonitor (ç›‘æ§å‘Šè­¦)                                â”‚
â”‚  â”œâ”€â”€ WAF (Webåº”ç”¨é˜²ç«å¢™)                                     â”‚
â”‚  â”œâ”€â”€ Anti-DDoS (DDoSé˜²æŠ¤)                                   â”‚
â”‚  â””â”€â”€ RAM (è®¿é—®æ§åˆ¶)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.2 Docker Composeé…ç½®

```yaml
# docker-compose.yml
version: '3.8'

services:
  # Nginxåå‘ä»£ç†
  nginx:
    image: nginx:alpine
    container_name: trade-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/conf.d:/etc/nginx/conf.d
      - ./ssl:/etc/nginx/ssl
      - ./web/dist:/usr/share/nginx/html
    depends_on:
      - api
      - websocket
    networks:
      - trade-network
    restart: unless-stopped

  # APIæœåŠ¡
  api:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: trade-api
    environment:
      - NODE_ENV=production
      - DATABASE_URL=mysql://root:${MYSQL_ROOT_PASSWORD}@mysql:3306/trade_db
      - REDIS_URL=redis://redis:6379
      - JWT_ACCESS_SECRET=${JWT_ACCESS_SECRET}
      - JWT_REFRESH_SECRET=${JWT_REFRESH_SECRET}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
    volumes:
      - ./uploads:/app/uploads
    depends_on:
      - mysql
      - redis
      - elasticsearch
    networks:
      - trade-network
    restart: unless-stopped
    deploy:
      replicas: 2
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  # WebSocketæœåŠ¡
  websocket:
    build:
      context: ./websocket
      dockerfile: Dockerfile
    container_name: trade-websocket
    environment:
      - NODE_ENV=production
      - REDIS_URL=redis://redis:6379
      - JWT_ACCESS_SECRET=${JWT_ACCESS_SECRET}
    depends_on:
      - redis
    networks:
      - trade-network
    restart: unless-stopped

  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    container_name: trade-mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=trade_db
      - MYSQL_USER=trade_user
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
    volumes:
      - mysql_data:/var/lib/mysql
      - ./mysql/conf.d:/etc/mysql/conf.d
      - ./mysql/init:/docker-entrypoint-initdb.d
    ports:
      - "3306:3306"
    networks:
      - trade-network
    restart: unless-stopped
    command: >
      --default-authentication-plugin=mysql_native_password
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
      --innodb-buffer-pool-size=256M
      --max-connections=200

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: trade-redis
    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD}
    volumes:
      - redis_data:/data
      - ./redis/redis.conf:/etc/redis/redis.conf
    ports:
      - "6379:6379"
    networks:
      - trade-network
    restart: unless-stopped

  # Elasticsearchæœç´¢
  elasticsearch:
    image: elasticsearch:8.8.0
    container_name: trade-elasticsearch
    environment:
      - discovery.type=single-node
      - ES_JAVA_OPTS=-Xms512m -Xmx512m
      - xpack.security.enabled=false
    volumes:
      - elasticsearch_data:/usr/share/elasticsearch/data
    ports:
      - "9200:9200"
    networks:
      - trade-network
    restart: unless-stopped

  # Kibana (å¯é€‰ï¼Œç”¨äºESç®¡ç†)
  kibana:
    image: kibana:8.8.0
    container_name: trade-kibana
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    ports:
      - "5601:5601"
    depends_on:
      - elasticsearch
    networks:
      - trade-network
    restart: unless-stopped

volumes:
  mysql_data:
  redis_data:
  elasticsearch_data:

networks:
  trade-network:
    driver: bridge
```

#### 1.3 Nginxé…ç½®

```nginx
# nginx/nginx.conf
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
    use epoll;
    multi_accept on;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';
    
    access_log /var/log/nginx/access.log main;
    
    # åŸºç¡€é…ç½®
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    client_max_body_size 50M;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json;
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # ä¸Šæ¸¸æœåŠ¡å™¨
    upstream api_backend {
        least_conn;
        server api:3000 max_fails=3 fail_timeout=30s;
        keepalive 32;
    }
    
    upstream websocket_backend {
        server websocket:3001;
    }
    
    # åŒ…å«ç«™ç‚¹é…ç½®
    include /etc/nginx/conf.d/*.conf;
}
```

```nginx
# nginx/conf.d/default.conf
server {
    listen 80;
    server_name localhost;
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name localhost;
    
    # SSLé…ç½®
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html;
        
        # ç¼“å­˜é™æ€èµ„æº
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # APIæ¥å£
    location /api/ {
        proxy_pass http://api_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
    
    # WebSocketè¿æ¥
    location /ws/ {
        proxy_pass http://websocket_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocketç‰¹æ®Šé…ç½®
        proxy_read_timeout 86400;
        proxy_send_timeout 86400;
    }
    
    # æ–‡ä»¶ä¸Šä¼ 
    location /uploads/ {
        alias /app/uploads/;
        expires 30d;
        add_header Cache-Control "public";
    }
    
    # å¥åº·æ£€æŸ¥
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
```

### 2. ç›‘æ§ä¸æ—¥å¿—

#### 2.1 åº”ç”¨ç›‘æ§é…ç½®

```typescript
// ç›‘æ§æœåŠ¡
import { Request, Response, NextFunction } from 'express';
import { Redis } from 'ioredis';

interface MetricData {
  timestamp: number;
  value: number;
  tags?: Record<string, string>;
}

interface PerformanceMetrics {
  responseTime: number;
  memoryUsage: NodeJS.MemoryUsage;
  cpuUsage: NodeJS.CpuUsage;
  activeConnections: number;
}

class MonitoringService {
  private redis: Redis;
  private metrics: Map<string, MetricData[]> = new Map();
  
  constructor(redis: Redis) {
    this.redis = redis;
    this.startMetricsCollection();
  }
  
  /**
   * æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶
   */
  performanceMiddleware = () => {
    return (req: Request, res: Response, next: NextFunction): void => {
      const startTime = Date.now();
      const startCpuUsage = process.cpuUsage();
      
      // ç›‘å¬å“åº”ç»“æŸäº‹ä»¶
      res.on('finish', () => {
        const responseTime = Date.now() - startTime;
        const cpuUsage = process.cpuUsage(startCpuUsage);
        
        // è®°å½•æ€§èƒ½æŒ‡æ ‡
        this.recordMetric('api_response_time', {
          timestamp: Date.now(),
          value: responseTime,
          tags: {
            method: req.method,
            route: req.route?.path || req.path,
            status: res.statusCode.toString()
          }
        });
        
        // è®°å½•CPUä½¿ç”¨æƒ…å†µ
        this.recordMetric('api_cpu_usage', {
          timestamp: Date.now(),
          value: cpuUsage.user + cpuUsage.system,
          tags: {
            method: req.method,
            route: req.route?.path || req.path
          }
        });
        
        // å¼‚å¸¸å“åº”æ—¶é—´å‘Šè­¦
        if (responseTime > 5000) {
          this.sendAlert('slow_response', {
            route: req.route?.path || req.path,
            responseTime,
            timestamp: new Date().toISOString()
          });
        }
      });
      
      next();
    };
  };
  
  /**
   * è®°å½•è‡ªå®šä¹‰æŒ‡æ ‡
   * @param metricName æŒ‡æ ‡åç§°
   * @param data æŒ‡æ ‡æ•°æ®
   */
  recordMetric(metricName: string, data: MetricData): void {
    if (!this.metrics.has(metricName)) {
      this.metrics.set(metricName, []);
    }
    
    const metrics = this.metrics.get(metricName)!;
    metrics.push(data);
    
    // ä¿æŒæœ€è¿‘1000æ¡è®°å½•
    if (metrics.length > 1000) {
      metrics.shift();
    }
    
    // å¼‚æ­¥å­˜å‚¨åˆ°Redis
    this.storeMetricToRedis(metricName, data);
  }
  
  /**
   * è·å–ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
   */
  getPerformanceMetrics(): PerformanceMetrics {
    const memoryUsage = process.memoryUsage();
    const cpuUsage = process.cpuUsage();
    
    return {
      responseTime: this.getAverageResponseTime(),
      memoryUsage,
      cpuUsage,
      activeConnections: this.getActiveConnections()
    };
  }
  
  /**
   * å‘é€å‘Šè­¦
   * @param alertType å‘Šè­¦ç±»å‹
   * @param data å‘Šè­¦æ•°æ®
   */
  private async sendAlert(alertType: string, data: any): Promise<void> {
    try {
      const alertData = {
        type: alertType,
        timestamp: new Date().toISOString(),
        data,
        severity: this.getAlertSeverity(alertType)
      };
      
      // å­˜å‚¨å‘Šè­¦åˆ°Redis
      await this.redis.lpush('alerts', JSON.stringify(alertData));
      await this.redis.ltrim('alerts', 0, 999); // ä¿æŒæœ€è¿‘1000æ¡å‘Šè­¦
      
      // è¿™é‡Œå¯ä»¥é›†æˆé’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ç­‰å‘Šè­¦é€šçŸ¥
      console.warn(`[ALERT] ${alertType}:`, data);
    } catch (error) {
      console.error('å‘é€å‘Šè­¦å¤±è´¥:', error);
    }
  }
  
  /**
   * è·å–å‘Šè­¦ä¸¥é‡ç¨‹åº¦
   */
  private getAlertSeverity(alertType: string): 'low' | 'medium' | 'high' | 'critical' {
    const severityMap: Record<string, 'low' | 'medium' | 'high' | 'critical'> = {
      slow_response: 'medium',
      high_memory: 'high',
      high_cpu: 'high',
      database_error: 'critical',
      redis_error: 'high'
    };
    
    return severityMap[alertType] || 'low';
  }
  
  /**
   * å¯åŠ¨æŒ‡æ ‡æ”¶é›†
   */
  private startMetricsCollection(): void {
    // æ¯30ç§’æ”¶é›†ä¸€æ¬¡ç³»ç»ŸæŒ‡æ ‡
    setInterval(() => {
      const memoryUsage = process.memoryUsage();
      const cpuUsage = process.cpuUsage();
      
      // è®°å½•å†…å­˜ä½¿ç”¨æƒ…å†µ
      this.recordMetric('system_memory', {
        timestamp: Date.now(),
        value: memoryUsage.heapUsed,
        tags: { type: 'heap_used' }
      });
      
      // è®°å½•CPUä½¿ç”¨æƒ…å†µ
      this.recordMetric('system_cpu', {
        timestamp: Date.now(),
        value: cpuUsage.user + cpuUsage.system,
        tags: { type: 'total' }
      });
      
      // å†…å­˜ä½¿ç”¨å‘Šè­¦ï¼ˆè¶…è¿‡500MBï¼‰
      if (memoryUsage.heapUsed > 500 * 1024 * 1024) {
        this.sendAlert('high_memory', {
          heapUsed: memoryUsage.heapUsed,
          heapTotal: memoryUsage.heapTotal,
          timestamp: new Date().toISOString()
        });
      }
    }, 30000);
  }
  
  /**
   * å­˜å‚¨æŒ‡æ ‡åˆ°Redis
   */
  private async storeMetricToRedis(metricName: string, data: MetricData): Promise<void> {
    try {
      const key = `metrics:${metricName}`;
      await this.redis.zadd(key, data.timestamp, JSON.stringify(data));
      
      // ä¿æŒæœ€è¿‘24å°æ—¶çš„æ•°æ®
      const oneDayAgo = Date.now() - 24 * 60 * 60 * 1000;
      await this.redis.zremrangebyscore(key, 0, oneDayAgo);
    } catch (error) {
      console.error('å­˜å‚¨æŒ‡æ ‡åˆ°Rediså¤±è´¥:', error);
    }
  }
  
  /**
   * è·å–å¹³å‡å“åº”æ—¶é—´
   */
  private getAverageResponseTime(): number {
    const responseTimeMetrics = this.metrics.get('api_response_time') || [];
    if (responseTimeMetrics.length === 0) return 0;
    
    const total = responseTimeMetrics.reduce((sum, metric) => sum + metric.value, 0);
    return total / responseTimeMetrics.length;
  }
  
  /**
   * è·å–æ´»è·ƒè¿æ¥æ•°
   */
  private getActiveConnections(): number {
    // è¿™é‡Œéœ€è¦æ ¹æ®å®é™…çš„è¿æ¥æ± å®ç°
    return 0;
  }
}

export default MonitoringService;
```

#### 2.2 æ—¥å¿—ç®¡ç†

```typescript
// æ—¥å¿—æœåŠ¡
import winston from 'winston';
import DailyRotateFile from 'winston-daily-rotate-file';
import { Request, Response, NextFunction } from 'express';

interface LogContext {
  userId?: number;
  sessionId?: string;
  ip?: string;
  userAgent?: string;
  requestId?: string;
}

class LoggerService {
  private logger: winston.Logger;
  
  constructor() {
    this.logger = winston.createLogger({
      level: process.env.LOG_LEVEL || 'info',
      format: winston.format.combine(
        winston.format.timestamp(),
        winston.format.errors({ stack: true }),
        winston.format.json()
      ),
      defaultMeta: {
        service: 'trade-platform',
        version: process.env.APP_VERSION || '1.0.0'
      },
      transports: [
        // æ§åˆ¶å°è¾“å‡º
        new winston.transports.Console({
          format: winston.format.combine(
            winston.format.colorize(),
            winston.format.simple()
          )
        }),
        
        // é”™è¯¯æ—¥å¿—æ–‡ä»¶
        new DailyRotateFile({
          filename: 'logs/error-%DATE%.log',
          datePattern: 'YYYY-MM-DD',
          level: 'error',
          maxSize: '20m',
          maxFiles: '14d',
          zippedArchive: true
        }),
        
        // åº”ç”¨æ—¥å¿—æ–‡ä»¶
        new DailyRotateFile({
          filename: 'logs/app-%DATE%.log',
          datePattern: 'YYYY-MM-DD',
          maxSize: '20m',
          maxFiles: '30d',
          zippedArchive: true
        }),
        
        // è®¿é—®æ—¥å¿—æ–‡ä»¶
        new DailyRotateFile({
          filename: 'logs/access-%DATE%.log',
          datePattern: 'YYYY-MM-DD',
          level: 'http',
          maxSize: '20m',
          maxFiles: '7d',
          zippedArchive: true
        })
      ]
    });
  }
  
  /**
   * è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
   */
  requestLogger = () => {
    return (req: Request, res: Response, next: NextFunction): void => {
      const startTime = Date.now();
      const requestId = this.generateRequestId();
      
      // æ·»åŠ è¯·æ±‚IDåˆ°è¯·æ±‚å¯¹è±¡
      (req as any).requestId = requestId;
      
      // è®°å½•è¯·æ±‚å¼€å§‹
      this.info('Request started', {
        requestId,
        method: req.method,
        url: req.url,
        ip: req.ip,
        userAgent: req.get('User-Agent'),
        userId: (req as any).user?.userId
      });
      
      // ç›‘å¬å“åº”ç»“æŸ
      res.on('finish', () => {
        const duration = Date.now() - startTime;
        
        this.logger.log('http', 'Request completed', {
          requestId,
          method: req.method,
          url: req.url,
          statusCode: res.statusCode,
          duration,
          ip: req.ip,
          userAgent: req.get('User-Agent'),
          userId: (req as any).user?.userId
        });
      });
      
      next();
    };
  };
  
  /**
   * è®°å½•ä¿¡æ¯æ—¥å¿—
   * @param message æ—¥å¿—æ¶ˆæ¯
   * @param context ä¸Šä¸‹æ–‡ä¿¡æ¯
   */
  info(message: string, context?: LogContext): void {
    this.logger.info(message, context);
  }
  
  /**
   * è®°å½•è­¦å‘Šæ—¥å¿—
   * @param message æ—¥å¿—æ¶ˆæ¯
   * @param context ä¸Šä¸‹æ–‡ä¿¡æ¯
   */
  warn(message: string, context?: LogContext): void {
    this.logger.warn(message, context);
  }
  
  /**
   * è®°å½•é”™è¯¯æ—¥å¿—
   * @param message æ—¥å¿—æ¶ˆæ¯
   * @param error é”™è¯¯å¯¹è±¡
   * @param context ä¸Šä¸‹æ–‡ä¿¡æ¯
   */
  error(message: string, error?: Error, context?: LogContext): void {
    this.logger.error(message, {
      ...context,
      error: error ? {
        message: error.message,
        stack: error.stack,
        name: error.name
      } : undefined
    });
  }
  
  /**
   * è®°å½•è°ƒè¯•æ—¥å¿—
   * @param message æ—¥å¿—æ¶ˆæ¯
   * @param context ä¸Šä¸‹æ–‡ä¿¡æ¯
   */
  debug(message: string, context?: LogContext): void {
    this.logger.debug(message, context);
  }
  
  /**
   * è®°å½•ä¸šåŠ¡æ“ä½œæ—¥å¿—
   * @param action æ“ä½œç±»å‹
   * @param details æ“ä½œè¯¦æƒ…
   * @param context ä¸Šä¸‹æ–‡ä¿¡æ¯
   */
  logBusinessAction(
    action: string,
    details: Record<string, any>,
    context?: LogContext
  ): void {
    this.logger.info(`Business Action: ${action}`, {
      ...context,
      action,
      details,
      timestamp: new Date().toISOString()
    });
  }
  
  /**
   * è®°å½•å®‰å…¨äº‹ä»¶
   * @param event å®‰å…¨äº‹ä»¶ç±»å‹
   * @param details äº‹ä»¶è¯¦æƒ…
   * @param context ä¸Šä¸‹æ–‡ä¿¡æ¯
   */
  logSecurityEvent(
    event: string,
    details: Record<string, any>,
    context?: LogContext
  ): void {
    this.logger.warn(`Security Event: ${event}`, {
      ...context,
      event,
      details,
      timestamp: new Date().toISOString(),
      severity: 'security'
    });
  }
  
  /**
   * ç”Ÿæˆè¯·æ±‚ID
   */
  private generateRequestId(): string {
    return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  }
}

export default LoggerService;
```

### 3. æ€§èƒ½ä¼˜åŒ–

#### 3.1 æ•°æ®åº“ä¼˜åŒ–ç­–ç•¥

```sql
-- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
-- ç”¨æˆ·è¡¨ç´¢å¼•
CREATE INDEX idx_users_phone ON users(phone);
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_users_created_at ON users(created_at);

-- èµ„æºè¡¨ç´¢å¼•
CREATE INDEX idx_resources_owner_id ON resources(owner_id);
CREATE INDEX idx_resources_category ON resources(category);
CREATE INDEX idx_resources_status ON resources(status);
CREATE INDEX idx_resources_location ON resources(latitude, longitude);
CREATE INDEX idx_resources_price ON resources(daily_price);
CREATE INDEX idx_resources_created_at ON resources(created_at);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_resources_search ON resources(category, status, daily_price);
CREATE INDEX idx_resources_location_search ON resources(latitude, longitude, status);

-- è®¢å•è¡¨ç´¢å¼•
CREATE INDEX idx_orders_renter_id ON orders(renter_id);
CREATE INDEX idx_orders_resource_id ON orders(resource_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_created_at ON orders(created_at);
CREATE INDEX idx_orders_date_range ON orders(start_date, end_date);

-- æ”¯ä»˜è¡¨ç´¢å¼•
CREATE INDEX idx_payments_order_id ON payments(order_id);
CREATE INDEX idx_payments_status ON payments(status);
CREATE INDEX idx_payments_created_at ON payments(created_at);

-- è¯„ä»·è¡¨ç´¢å¼•
CREATE INDEX idx_reviews_resource_id ON reviews(resource_id);
CREATE INDEX idx_reviews_reviewer_id ON reviews(reviewer_id);
CREATE INDEX idx_reviews_rating ON reviews(rating);

-- æ¶ˆæ¯è¡¨ç´¢å¼•
CREATE INDEX idx_messages_conversation_id ON messages(conversation_id);
CREATE INDEX idx_messages_sender_id ON messages(sender_id);
CREATE INDEX idx_messages_created_at ON messages(created_at);

-- åˆ†åŒºè¡¨ï¼ˆé’ˆå¯¹å¤§æ•°æ®é‡ï¼‰
-- æŒ‰æœˆåˆ†åŒºæ“ä½œæ—¥å¿—è¡¨
ALTER TABLE operation_logs PARTITION BY RANGE (YEAR(created_at) * 100 + MONTH(created_at)) (
    PARTITION p202401 VALUES LESS THAN (202402),
    PARTITION p202402 VALUES LESS THAN (202403),
    PARTITION p202403 VALUES LESS THAN (202404),
    -- ç»§ç»­æ·»åŠ æ›´å¤šåˆ†åŒº...
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

#### 3.2 ç¼“å­˜ç­–ç•¥

```typescript
// ç¼“å­˜ç®¡ç†å™¨
import { Redis } from 'ioredis';

interface CacheOptions {
  ttl?: number;           // è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
  prefix?: string;        // é”®å‰ç¼€
  serialize?: boolean;    // æ˜¯å¦åºåˆ—åŒ–
}

class CacheManager {
  private redis: Redis;
  private defaultTTL: number = 3600; // é»˜è®¤1å°æ—¶
  
  constructor(redis: Redis) {
    this.redis = redis;
  }
  
  /**
   * è®¾ç½®ç¼“å­˜
   * @param key ç¼“å­˜é”®
   * @param value ç¼“å­˜å€¼
   * @param options ç¼“å­˜é€‰é¡¹
   */
  async set(
    key: string,
    value: any,
    options: CacheOptions = {}
  ): Promise<void> {
    const {
      ttl = this.defaultTTL,
      prefix = 'cache',
      serialize = true
    } = options;
    
    const cacheKey = `${prefix}:${key}`;
    const cacheValue = serialize ? JSON.stringify(value) : value;
    
    if (ttl > 0) {
      await this.redis.setex(cacheKey, ttl, cacheValue);
    } else {
      await this.redis.set(cacheKey, cacheValue);
    }
  }
  
  /**
   * è·å–ç¼“å­˜
   * @param key ç¼“å­˜é”®
   * @param options ç¼“å­˜é€‰é¡¹
   */
  async get<T = any>(
    key: string,
    options: CacheOptions = {}
  ): Promise<T | null> {
    const {
      prefix = 'cache',
      serialize = true
    } = options;
    
    const cacheKey = `${prefix}:${key}`;
    const value = await this.redis.get(cacheKey);
    
    if (value === null) {
      return null;
    }
    
    return serialize ? JSON.parse(value) : value;
  }
  
  /**
   * åˆ é™¤ç¼“å­˜
   * @param key ç¼“å­˜é”®
   * @param prefix é”®å‰ç¼€
   */
  async del(key: string, prefix: string = 'cache'): Promise<void> {
    const cacheKey = `${prefix}:${key}`;
    await this.redis.del(cacheKey);
  }
  
  /**
   * æ‰¹é‡åˆ é™¤ç¼“å­˜
   * @param pattern åŒ¹é…æ¨¡å¼
   */
  async delPattern(pattern: string): Promise<void> {
    const keys = await this.redis.keys(pattern);
    if (keys.length > 0) {
      await this.redis.del(...keys);
    }
  }
  
  /**
   * ç¼“å­˜è£…é¥°å™¨
   * @param cacheKey ç¼“å­˜é”®ç”Ÿæˆå‡½æ•°
   * @param ttl è¿‡æœŸæ—¶é—´
   */
  cacheDecorator(
    cacheKey: (...args: any[]) => string,
    ttl: number = this.defaultTTL
  ) {
    return (target: any, propertyName: string, descriptor: PropertyDescriptor) => {
      const method = descriptor.value;
      
      descriptor.value = async function (...args: any[]) {
        const key = cacheKey(...args);
        
        // å°è¯•ä»ç¼“å­˜è·å–
        const cached = await this.cacheManager.get(key);
        if (cached !== null) {
          return cached;
        }
        
        // æ‰§è¡ŒåŸæ–¹æ³•
        const result = await method.apply(this, args);
        
        // å­˜å‚¨åˆ°ç¼“å­˜
        await this.cacheManager.set(key, result, { ttl });
        
        return result;
      };
    };
  }
  
  /**
   * çƒ­ç‚¹æ•°æ®é¢„åŠ è½½
   */
  async preloadHotData(): Promise<void> {
    try {
      // é¢„åŠ è½½çƒ­é—¨èµ„æºåˆ†ç±»
      const categories = await this.getPopularCategories();
      await this.set('popular_categories', categories, { ttl: 1800 }); // 30åˆ†é’Ÿ
      
      // é¢„åŠ è½½çƒ­é—¨åŸå¸‚
      const cities = await this.getPopularCities();
      await this.set('popular_cities', cities, { ttl: 3600 }); // 1å°æ—¶
      
      // é¢„åŠ è½½ç³»ç»Ÿé…ç½®
      const config = await this.getSystemConfig();
      await this.set('system_config', config, { ttl: 600 }); // 10åˆ†é’Ÿ
      
      console.log('çƒ­ç‚¹æ•°æ®é¢„åŠ è½½å®Œæˆ');
    } catch (error) {
      console.error('çƒ­ç‚¹æ•°æ®é¢„åŠ è½½å¤±è´¥:', error);
    }
  }
  
  /**
   * è·å–çƒ­é—¨åˆ†ç±»ï¼ˆç¤ºä¾‹ï¼‰
   */
  private async getPopularCategories(): Promise<string[]> {
    // è¿™é‡Œåº”è¯¥æŸ¥è¯¢æ•°æ®åº“è·å–çƒ­é—¨åˆ†ç±»
    return ['electronics', 'vehicles', 'tools', 'sports'];
  }
  
  /**
   * è·å–çƒ­é—¨åŸå¸‚ï¼ˆç¤ºä¾‹ï¼‰
   */
  private async getPopularCities(): Promise<string[]> {
    // è¿™é‡Œåº”è¯¥æŸ¥è¯¢æ•°æ®åº“è·å–çƒ­é—¨åŸå¸‚
    return ['åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æ­å·'];
  }
  
  /**
   * è·å–ç³»ç»Ÿé…ç½®ï¼ˆç¤ºä¾‹ï¼‰
   */
  private async getSystemConfig(): Promise<Record<string, any>> {
    // è¿™é‡Œåº”è¯¥æŸ¥è¯¢æ•°æ®åº“è·å–ç³»ç»Ÿé…ç½®
    return {
      platformFeeRate: 0.05,
      minDepositRatio: 0.2,
      maxRentalDays: 30
    };
  }
}

export default CacheManager;
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

#### 1.1 Jesté…ç½®

```json
// jest.config.js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  roots: ['<rootDir>/src', '<rootDir>/tests'],
  testMatch: [
    '**/__tests__/**/*.ts',
    '**/?(*.)+(spec|test).ts'
  ],
  transform: {
    '^.+\.ts$': 'ts-jest'
  },
  collectCoverageFrom: [
    'src/**/*.ts',
    '!src/**/*.d.ts',
    '!src/index.ts'
  ],
  coverageDirectory: 'coverage',
  coverageReporters: [
    'text',
    'lcov',
    'html'
  ],
  setupFilesAfterEnv: ['<rootDir>/tests/setup.ts'],
  testTimeout: 10000
};
```

#### 1.2 æµ‹è¯•ç¤ºä¾‹

```typescript
// tests/services/auth.service.test.ts
import AuthService from '../../src/services/auth.service';
import { Redis } from 'ioredis';
import bcrypt from 'bcrypt';

// Mock Redis
const mockRedis = {
  set: jest.fn(),
  get: jest.fn(),
  del: jest.fn(),
  expire: jest.fn()
} as unknown as Redis;

// Mock bcrypt
jest.mock('bcrypt');
const mockBcrypt = bcrypt as jest.Mocked<typeof bcrypt>;

describe('AuthService', () => {
  let authService: AuthService;
  
  beforeEach(() => {
    authService = new AuthService(mockRedis);
    jest.clearAllMocks();
  });
  
  describe('hashPassword', () => {
    it('åº”è¯¥æ­£ç¡®å“ˆå¸Œå¯†ç ', async () => {
      // Arrange
      const password = 'testPassword123';
      const hashedPassword = 'hashedPassword';
      mockBcrypt.hash.mockResolvedValue(hashedPassword);
      
      // Act
      const result = await authService.hashPassword(password);
      
      // Assert
      expect(result).toBe(hashedPassword);
      expect(mockBcrypt.hash).toHaveBeenCalledWith(password, 12);
    });
    
    it('åº”è¯¥åœ¨å¯†ç ä¸ºç©ºæ—¶æŠ›å‡ºé”™è¯¯', async () => {
      // Arrange
      const password = '';
      
      // Act & Assert
      await expect(authService.hashPassword(password))
        .rejects.toThrow('å¯†ç ä¸èƒ½ä¸ºç©º');
    });
  });
  
  describe('verifyPassword', () => {
    it('åº”è¯¥æ­£ç¡®éªŒè¯å¯†ç ', async () => {
      // Arrange
      const password = 'testPassword123';
      const hashedPassword = 'hashedPassword';
      mockBcrypt.compare.mockResolvedValue(true);
      
      // Act
      const result = await authService.verifyPassword(password, hashedPassword);
      
      // Assert
      expect(result).toBe(true);
      expect(mockBcrypt.compare).toHaveBeenCalledWith(password, hashedPassword);
    });
    
    it('åº”è¯¥åœ¨å¯†ç é”™è¯¯æ—¶è¿”å›false', async () => {
      // Arrange
      const password = 'wrongPassword';
      const hashedPassword = 'hashedPassword';
      mockBcrypt.compare.mockResolvedValue(false);
      
      // Act
      const result = await authService.verifyPassword(password, hashedPassword);
      
      // Assert
      expect(result).toBe(false);
    });
  });
  
  describe('generateTokenPair', () => {
    it('åº”è¯¥ç”Ÿæˆè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ', async () => {
      // Arrange
      const payload = {
        userId: 1,
        phone: '13800138000',
        role: 'user'
      };
      
      // Mock Redis operations
      mockRedis.set = jest.fn().mockResolvedValue('OK');
      mockRedis.expire = jest.fn().mockResolvedValue(1);
      
      // Act
      const result = await authService.generateTokenPair(payload);
      
      // Assert
      expect(result).toHaveProperty('accessToken');
      expect(result).toHaveProperty('refreshToken');
      expect(result).toHaveProperty('expiresIn');
      expect(typeof result.accessToken).toBe('string');
      expect(typeof result.refreshToken).toBe('string');
      expect(result.expiresIn).toBe(900); // 15åˆ†é’Ÿ
    });
  });
});
```

### 2. é›†æˆæµ‹è¯•

```typescript
// tests/integration/auth.integration.test.ts
import request from 'supertest';
import app from '../../src/app';
import { DatabaseManager } from '../../src/database';
import { Redis } from 'ioredis';

describe('Auth Integration Tests', () => {
  let redis: Redis;
  
  beforeAll(async () => {
    // åˆå§‹åŒ–æµ‹è¯•æ•°æ®åº“
    await DatabaseManager.connect();
    redis = new Redis(process.env.REDIS_TEST_URL);
  });
  
  afterAll(async () => {
    // æ¸…ç†æµ‹è¯•æ•°æ®
    await DatabaseManager.disconnect();
    await redis.disconnect();
  });
  
  beforeEach(async () => {
    // æ¸…ç†æµ‹è¯•æ•°æ®
    await redis.flushdb();
  });
  
  describe('POST /api/auth/register', () => {
    it('åº”è¯¥æˆåŠŸæ³¨å†Œæ–°ç”¨æˆ·', async () => {
      // Arrange
      const userData = {
        phone: '13800138000',
        password: 'testPassword123',
        nickname: 'æµ‹è¯•ç”¨æˆ·',
        verificationCode: '123456'
      };
      
      // MockéªŒè¯ç 
      await redis.set('sms:13800138000', '123456', 'EX', 300);
      
      // Act
      const response = await request(app)
        .post('/api/auth/register')
        .send(userData)
        .expect(201);
      
      // Assert
      expect(response.body).toMatchObject({
        success: true,
        message: 'æ³¨å†ŒæˆåŠŸ',
        data: {
          user: {
            phone: '13800138000',
            nickname: 'æµ‹è¯•ç”¨æˆ·'
          },
          tokens: {
            accessToken: expect.any(String),
            refreshToken: expect.any(String)
          }
        }
      });
    });
    
    it('åº”è¯¥åœ¨æ‰‹æœºå·å·²å­˜åœ¨æ—¶è¿”å›é”™è¯¯', async () => {
      // Arrange - å…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ·
      const existingUser = {
        phone: '13800138000',
        password: 'password123',
        nickname: 'å·²å­˜åœ¨ç”¨æˆ·',
        verificationCode: '123456'
      };
      
      await redis.set('sms:13800138000', '123456', 'EX', 300);
      await request(app).post('/api/auth/register').send(existingUser);
      
      // Act - å°è¯•ç”¨ç›¸åŒæ‰‹æœºå·æ³¨å†Œ
      const response = await request(app)
        .post('/api/auth/register')
        .send({
          phone: '13800138000',
          password: 'newPassword123',
          nickname: 'æ–°ç”¨æˆ·',
          verificationCode: '123456'
        })
        .expect(400);
      
      // Assert
      expect(response.body).toMatchObject({
        success: false,
        message: 'æ‰‹æœºå·å·²è¢«æ³¨å†Œ'
      });
    });
  });
  
  describe('POST /api/auth/login', () => {
    beforeEach(async () => {
      // åˆ›å»ºæµ‹è¯•ç”¨æˆ·
      const userData = {
        phone: '13800138000',
        password: 'testPassword123',
        nickname: 'æµ‹è¯•ç”¨æˆ·',
        verificationCode: '123456'
      };
      
      await redis.set('sms:13800138000', '123456', 'EX', 300);
      await request(app).post('/api/auth/register').send(userData);
    });
    
    it('åº”è¯¥æˆåŠŸç™»å½•', async () => {
      // Act
      const response = await request(app)
        .post('/api/auth/login')
        .send({
          phone: '13800138000',
          password: 'testPassword123'
        })
        .expect(200);
      
      // Assert
      expect(response.body).toMatchObject({
        success: true,
        message: 'ç™»å½•æˆåŠŸ',
        data: {
          user: {
            phone: '13800138000',
            nickname: 'æµ‹è¯•ç”¨æˆ·'
          },
          tokens: {
            accessToken: expect.any(String),
            refreshToken: expect.any(String)
          }
        }
      });
    });
    
    it('åº”è¯¥åœ¨å¯†ç é”™è¯¯æ—¶è¿”å›é”™è¯¯', async () => {
      // Act
      const response = await request(app)
        .post('/api/auth/login')
        .send({
          phone: '13800138000',
          password: 'wrongPassword'
        })
        .expect(401);
      
      // Assert
      expect(response.body).toMatchObject({
        success: false,
        message: 'æ‰‹æœºå·æˆ–å¯†ç é”™è¯¯'
      });
    });
  });
});
```

### 3. ç«¯åˆ°ç«¯æµ‹è¯•

```typescript
// tests/e2e/user-journey.e2e.test.ts
import { chromium, Browser, Page } from 'playwright';

describe('ç”¨æˆ·å®Œæ•´æµç¨‹æµ‹è¯•', () => {
  let browser: Browser;
  let page: Page;
  
  beforeAll(async () => {
    browser = await chromium.launch({ headless: false });
  });
  
  afterAll(async () => {
    await browser.close();
  });
  
  beforeEach(async () => {
    page = await browser.newPage();
    await page.goto('http://localhost:3000');
  });
  
  afterEach(async () => {
    await page.close();
  });
  
  it('ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€å‘å¸ƒèµ„æºã€ä¸‹å•çš„å®Œæ•´æµç¨‹', async () => {
    // 1. ç”¨æˆ·æ³¨å†Œ
    await page.click('[data-testid="register-button"]');
    await page.fill('[data-testid="phone-input"]', '13800138000');
    await page.fill('[data-testid="password-input"]', 'testPassword123');
    await page.fill('[data-testid="nickname-input"]', 'æµ‹è¯•ç”¨æˆ·');
    
    // æ¨¡æ‹Ÿè·å–éªŒè¯ç 
    await page.click('[data-testid="get-code-button"]');
    await page.fill('[data-testid="code-input"]', '123456');
    
    await page.click('[data-testid="register-submit"]');
    
    // éªŒè¯æ³¨å†ŒæˆåŠŸ
    await expect(page.locator('[data-testid="success-message"]'))
      .toContainText('æ³¨å†ŒæˆåŠŸ');
    
    // 2. å‘å¸ƒèµ„æº
    await page.click('[data-testid="publish-resource"]');
    await page.fill('[data-testid="resource-title"]', 'æµ‹è¯•èµ„æº');
    await page.selectOption('[data-testid="resource-category"]', 'electronics');
    await page.fill('[data-testid="resource-description"]', 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•èµ„æº');
    await page.fill('[data-testid="daily-price"]', '100');
    await page.fill('[data-testid="deposit"]', '500');
    
    // ä¸Šä¼ å›¾ç‰‡
    await page.setInputFiles('[data-testid="image-upload"]', 'tests/fixtures/test-image.jpg');
    
    await page.click('[data-testid="publish-submit"]');
    
    // éªŒè¯å‘å¸ƒæˆåŠŸ
    await expect(page.locator('[data-testid="success-message"]'))
      .toContainText('å‘å¸ƒæˆåŠŸ');
    
    // 3. æœç´¢å’Œé¢„è®¢èµ„æº
    await page.fill('[data-testid="search-input"]', 'æµ‹è¯•èµ„æº');
    await page.click('[data-testid="search-button"]');
    
    // ç‚¹å‡»æœç´¢ç»“æœ
    await page.click('[data-testid="resource-item"]:first-child');
    
    // é€‰æ‹©ç§Ÿèµæ—¥æœŸ
    await page.click('[data-testid="start-date"]');
    await page.click('[data-testid="date-today"]');
    await page.click('[data-testid="end-date"]');
    await page.click('[data-testid="date-tomorrow"]');
    
    await page.click('[data-testid="book-now"]');
    
    // 4. æ”¯ä»˜
    await page.click('[data-testid="pay-button"]');
    
    // æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ
    await page.waitForSelector('[data-testid="payment-success"]');
    
    // éªŒè¯è®¢å•åˆ›å»ºæˆåŠŸ
    await expect(page.locator('[data-testid="order-status"]'))
      .toContainText('å¾…ç¡®è®¤');
  });
  
  it('å“åº”å¼è®¾è®¡æµ‹è¯•', async () => {
    // æµ‹è¯•ç§»åŠ¨ç«¯è§†å›¾
    await page.setViewportSize({ width: 375, height: 667 });
    
    // éªŒè¯ç§»åŠ¨ç«¯å¯¼èˆª
    await expect(page.locator('[data-testid="mobile-menu"]')).toBeVisible();
    
    // æµ‹è¯•å¹³æ¿è§†å›¾
    await page.setViewportSize({ width: 768, height: 1024 });
    
    // éªŒè¯å¹³æ¿ç«¯å¸ƒå±€
    await expect(page.locator('[data-testid="tablet-layout"]')).toBeVisible();
    
    // æµ‹è¯•æ¡Œé¢ç«¯è§†å›¾
    await page.setViewportSize({ width: 1920, height: 1080 });
    
    // éªŒè¯æ¡Œé¢ç«¯å¸ƒå±€
    await expect(page.locator('[data-testid="desktop-layout"]')).toBeVisible();
  });
});
```

---

## ğŸ“‹ æ€»ç»“

æœ¬è®¾è®¡æ–‡æ¡£è¯¦ç»†è§„åˆ’äº†é—²ç½®èµ„æºç§Ÿèµå¹³å°çš„æŠ€æœ¯æ¶æ„å’Œå®ç°æ–¹æ¡ˆï¼Œæ¶µç›–äº†ï¼š

### ğŸ—ï¸ æ ¸å¿ƒæ¶æ„
- **å¾®æœåŠ¡æ¶æ„**ï¼šAPIæœåŠ¡ã€WebSocketæœåŠ¡ã€å®šæ—¶ä»»åŠ¡æœåŠ¡
- **æ•°æ®åº“è®¾è®¡**ï¼šMySQLä¸»æ•°æ®åº“ + Redisç¼“å­˜ + Elasticsearchæœç´¢
- **å‰ç«¯æ¶æ„**ï¼šReact Webåº”ç”¨ + React Nativeç§»åŠ¨åº”ç”¨

### ğŸ” å®‰å…¨è®¾è®¡
- **JWTè®¤è¯æœºåˆ¶**ï¼šè®¿é—®ä»¤ç‰Œ + åˆ·æ–°ä»¤ç‰ŒåŒä»¤ç‰Œä½“ç³»
- **æƒé™æ§åˆ¶**ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰
- **æ•°æ®åŠ å¯†**ï¼šæ•æ„Ÿæ•°æ®AES-256-GCMåŠ å¯†
- **APIå®‰å…¨**ï¼šè¯·æ±‚é¢‘ç‡é™åˆ¶ã€è¾“å…¥éªŒè¯ã€HTTPSå¼ºåˆ¶

### ğŸš€ æ€§èƒ½ä¼˜åŒ–
- **ç¼“å­˜ç­–ç•¥**ï¼šå¤šå±‚ç¼“å­˜æ¶æ„ï¼Œçƒ­ç‚¹æ•°æ®é¢„åŠ è½½
- **æ•°æ®åº“ä¼˜åŒ–**ï¼šç´¢å¼•ä¼˜åŒ–ã€åˆ†åŒºè¡¨ã€è¯»å†™åˆ†ç¦»
- **CDNåŠ é€Ÿ**ï¼šé™æ€èµ„æºå…¨çƒåˆ†å‘
- **è´Ÿè½½å‡è¡¡**ï¼šå¤šå®ä¾‹éƒ¨ç½²ï¼Œè‡ªåŠ¨æ‰©ç¼©å®¹

### ğŸ“Š ç›‘æ§è¿ç»´
- **åº”ç”¨ç›‘æ§**ï¼šæ€§èƒ½æŒ‡æ ‡æ”¶é›†ã€å¼‚å¸¸å‘Šè­¦
- **æ—¥å¿—ç®¡ç†**ï¼šç»“æ„åŒ–æ—¥å¿—ã€æ—¥å¿—è½®è½¬ã€å®‰å…¨å®¡è®¡
- **éƒ¨ç½²æ¶æ„**ï¼šDockerå®¹å™¨åŒ–ã€é˜¿é‡Œäº‘åŸç”ŸæœåŠ¡

### ğŸ§ª è´¨é‡ä¿è¯
- **æµ‹è¯•ç­–ç•¥**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•
- **ä»£ç è´¨é‡**ï¼šTypeScriptç±»å‹å®‰å…¨ã€ESLintä»£ç è§„èŒƒ
- **æŒç»­é›†æˆ**ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•ã€è‡ªåŠ¨åŒ–éƒ¨ç½²

è¯¥è®¾è®¡æ–¹æ¡ˆç¡®ä¿äº†ç³»ç»Ÿçš„**é«˜å¯ç”¨æ€§**ã€**é«˜æ€§èƒ½**ã€**é«˜å®‰å…¨æ€§**å’Œ**å¯æ‰©å±•æ€§**ï¼Œä¸ºé—²ç½®èµ„æºç§Ÿèµå¹³å°çš„æˆåŠŸè¿è¥æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚